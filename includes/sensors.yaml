
- platform: time_date
  display_options:
    - 'time'
    - 'date'
- platform: feedparser
  scan_interval: 43200
  name: podcast_brains_on
  feed_url: https://feeds.publicradio.org/public_feeds/brains-on/rss/rss
  inclusions: 
    - title
    - links
    - published
- platform: feedparser
  scan_interval: 43200
  name: podcast_stories
  feed_url: https://rss.art19.com/stories-podcast
  inclusions: 
    - title
    - links
    - published
- platform: feedparser
  scan_interval: 43200
  name: podcast_girl_tales
  feed_url: https://feeds.megaphone.fm/CST7403212167
  inclusions: 
    - title
    - links
    - published
- platform: feedparser
  scan_interval: 43200
  name: podcast_finn_caspian
  feed_url: https://rss.art19.com/the-alien-adventures-of-finn-caspian
  inclusions: 
    - title
    - links
    - published
- platform: feedparser
  scan_interval: 43200
  name: podcast_but_why
  feed_url: https://podcasts.vpr.net/but-why
  inclusions: 
    - title
    - links
    - published
- platform: feedparser
  scan_interval: 43200
  name: podcast_story_pirates
  feed_url: https://feeds.megaphone.fm/storypirates
  inclusions: 
    - title
    - links
    - published
- platform: feedparser
  scan_interval: 43200
  name: podcast_sound_explorers
  feed_url: https://feeds.megaphone.fm/soundexplorers
  inclusions: 
    - title
    - links
    - published
- platform: feedparser
  scan_interval: 43200
  name: podcast_goodnight_stories
  feed_url: https://feeds.megaphone.fm/RGS8260109708
  inclusions: 
    - title
    - links
    - published
- platform: feedparser
  scan_interval: 43200
  name: podcast_marvellous_musical
  feed_url: https://rss.hosting.thisisdax.com/99ebc61a-7b26-4f76-b595-9e2020ad84ac
  inclusions: 
    - title
    - links
    - published
- platform: feedparser
  scan_interval: 43200
  name: podcast_peace_out
  feed_url: https://bedtime.fm/peaceout/feed
  inclusions: 
    - title
    - links
    - published
- platform: feedparser
  scan_interval: 43200
  name: QOTD
  feed_url: http://feeds.feedburner.com/theysaidso/qod/inspire
- platform: feedparser
  name: NASADAily
  feed_url: https://www.nasa.gov/rss/dyn/lg_image_of_the_day.rss
  scan_interval: 43200
  show_topn: 1  
- platform: feedparser
  name: BBC News
  feed_url: http://feeds.bbci.co.uk/news/rss.xml
  show_topn: 5
- platform: uk_transport
  scan_interval: 86400
  app_id: !secret uk_transport-app_id
  app_key: !secret uk_transport-app_key
  queries:
    - mode: train
      origin: SHY
      destination: LDS    
- platform: uk_transport
  scan_interval: 86400
  app_id: !secret uk_transport-app_id
  app_key: !secret uk_transport-app_key
  queries:
    - mode: train
      origin: LDS
      destination: SHY   
- platform: rest
  resource: https://complimentr.com/api
  method: GET
  name: compliment
  scan_interval: 3600
  value_template: '{{ value_json.compliment }}'
- platform: history_stats
  name: Quarantine meter Tom
  entity_id: person.tom
  state: "home"
  type: ratio
  duration:
    days: 7
  end: "{{ now() }}"
- platform: history_stats
  name: Quarantine meter Tom count left
  entity_id: person.tom
  state: "home"
  type: count
  duration:
    days: 7
  end: "{{ now() }}"
- platform: history_stats
  name: Quarantine meter Anna count left
  entity_id: person.anna
  state: "home"
  type: count
  duration:
    days: 7
  end: "{{ now() }}"
- platform: history_stats
  name: Quarantine meter Anna
  entity_id: person.anna
  state: "home"
  type: ratio
  duration:
    days: 7
  end: "{{ now() }}"
- platform: history_stats
  name: Washing Machine Count
  entity_id: binary_sensor.washer
  state: "on"
  type: count
  duration:
    days: 7
  end: "{{ now() }}"
- platform: history_stats
  name: Dishwasher Count
  entity_id: binary_sensor.dishwasher
  state: "on"
  type: count
  duration:
    days: 7
  end: "{{ now() }}"
  
# Sensors for the holiday mode lighting automation
# All sensors will have naming convention "sensor.replay_xxxxx"
- platform: history_stats
  name: "replay_living_room_lights"
  entity_id: light.living_room
  state: "on"
  type: count
  start: >
    {{ as_timestamp(now()) - (7*86400) }}
  duration: 00:00:30
- platform: history_stats
  name: "replay_main_bedroom"
  entity_id: light.main_bedroom
  state: "on"
  type: count
  start: >
    {{ as_timestamp(now()) - (7*86400) }}
  duration: 00:00:30  
- platform: history_stats
  name: "replay_main_bedroom_bloom"
  entity_id: light.main_bedroom_bloom
  state: "on"
  type: count
  start: >
    {{ as_timestamp(now()) - (7*86400) }}
  duration: 00:00:30
- platform: history_stats
  name: "replay_reuben_ceiling"
  entity_id: light.reubens_ceiling
  state: "on"
  type: count
  start: >
    {{ as_timestamp(now()) - (7*86400) }}
  duration: 00:00:30  
- platform: history_stats
  name: "replay_hallway"
  entity_id: light.hallway
  state: "on"
  type: count
  start: >
    {{ as_timestamp(now()) - (7*86400) }}
  duration: 00:00:30  
- platform: history_stats
  name: "replay_sebs_ceiling"
  entity_id: light.sebs_ceiling
  state: "on"
  type: count
  start: >
    {{ as_timestamp(now()) - (7*86400) }}
  duration: 00:00:30  

- platform: history_stats
  name: Raingauge tips on
  entity_id: binary_sensor.rain_gauge
  state: 'on'
  type: count
  start: '{{ now().replace(hour=0, minute=0, second=0) }}'
  end: '{{ now() }}'
- platform: history_stats
  name: Raingauge tips off
  entity_id: binary_sensor.rain_gauge
  state: 'off'
  type: count
  start: '{{ now().replace(hour=0, minute=0, second=0) }}'
  end: '{{ now() }}'  
- platform: min_max
  type: min
  name: all_temps_min
  entity_ids:
    - sensor.bathroom_climate_temperature
    - sensor.ensuite_climate_temperature
    - sensor.kitchen_climate_temperature
    - sensor.office_climate_temperature
    - sensor.main_bedroom_temperature
    - sensor.seb_d1_temperature
    - sensor.reu_d1_temperature
    - sensor.living_room_climate_temperature
- platform: min_max
  type: max
  name: all_temps_max
  entity_ids:
    - sensor.bathroom_climate_temperature
    - sensor.ensuite_climate_temperature
    - sensor.kitchen_climate_temperature
    - sensor.office_climate_temperature
    - sensor.main_bedroom_temperature
    - sensor.seb_d1_temperature
    - sensor.reu_d1_temperature
    - sensor.living_room_climate_temperature
- platform: statistics
  state_characteristic: mean
  name: temps_min_stats
  entity_id: sensor.all_temps_min
  sampling_size: 1000
  max_age:
    hours: 24
- platform: statistics
  state_characteristic: mean
  name: temps_max_stats
  entity_id: sensor.all_temps_max
  sampling_size: 1000
  max_age:
    hours: 24
- platform: statistics
  state_characteristic: mean
  sampling_size: 2000
  max_age:
    hours: 24
  name: pm2_5_max
  entity_id: sensor.air_quality_pm2_5
- platform: mqtt_room
  name: "Toms Phone BLE"
  device_id: "iBeacon:e740d314-4895-4c64-99b3-1efb7651d593-100-1"
  state_topic: "espresense/devices/iBeacon:e740d314-4895-4c64-99b3-1efb7651d593-100-1"
  timeout: 5
  away_timeout: 60
- platform: mqtt_room
  name: "Toms Watch BLE"
  device_id: "iBeacon:936e521c-74da-11ee-b962-0242ac120002-100-1"
  state_topic: "espresense/devices/iBeacon:936e521c-74da-11ee-b962-0242ac120002-100-1"
  timeout: 5
  away_timeout: 120
- platform: mqtt_room
  name: "Reubens MiBand"
  device_id: "mifit:ca53200f684b"
  state_topic: "espresense/devices/mifit:ca53200f684b"
  timeout: 5
  away_timeout: 60
- platform: mqtt_room
  name: "Sebs MiBand"
  device_id: "mifit:ca53200f684b"
  state_topic: "espresense/devices/mifit:ca53200f684b"
  timeout: 5
  away_timeout: 60
### Solax Local REST sensor ###
- platform: rest
  scan_interval: 30
  resource: !secret solax_local_ip
  payload: !secret solax_local_realtime_payload
  method: POST
  name: "solax_rest_local"
  json_attributes:
        - sn
        - ver
        - type
        - Data
        - Information
  value_template: 'OK'  # dummy value, not used; avoids the "State max length is 255 characters" error

### Solax Local REST settings ###
- platform: rest
  scan_interval: 300
  resource: !secret solax_local_ip
  payload: !secret solax_local_settings_payload
  method: POST
  name: "solax_rest_local_settings"
  # Unfortunately settings are not returned as a JSON document but an array of numbers, so having to pick just the relevant to avoid the max 255 chars limit
  # 0 - Self Use Min SOC %
  # 1 - Self Use Charge from grid (0 for disabled, 1 for enabled)
  # 2 - Self Use Charge from grid to % 
  # 3 - Forced charge start
  # 4 - Forced charge end
  # 5 - Allowed discharge start
  # 6 - Allowed discharge end
  # 7 - Charge/discharge Period2 Enabled (0 for disabled, 1 for enabled)
  # 8 - Work Mode (0: self use, 1: feed in priority, 2: back up, 3: manual)
  # 9 - Manual Mode (0: do nothing, 1: forced charge, 2: forced discharge)
  value_template: "{{ '[' ~ value.split(',')[28] ~ ',' ~ value.split(',')[29] ~ ',' ~ value.split(',')[30] ~ ',' ~ value.split(',')[36] ~ ',' ~ value.split(',')[37] ~ ',' ~ value.split(',')[38] ~ ',' ~ value.split(',')[39] ~ ',' ~ value.split(',')[40] ~ ',' ~ value.split(',')[27] ~ ',' ~ value.split(',')[35] ~ ']' }}"



- platform: history_stats
  name: airer_run_time
  entity_id: switch.heated_airer
  state: "on"
  type: time
  start: "{{ as_datetime(states('sensor.airer_requested_power')) }}"
  end: "{{ now() }}"
  
- platform: history_stats
  name: airer_total_daily_run_time
  entity_id: switch.heated_airer
  state: "on"
  type: time
  start: "{{ now().replace(hour=0, minute=0, second=0, microsecond=0) }}"
  duration:
    hours: 24 
- id: '1575922124106'
  alias: Close the blinds as dusk
  description: ''
  trigger:
  - platform: numeric_state
    entity_id: sun.sun
    below: '-2'
    attribute: elevation
  condition: []
  action:
  - alias: ''
    data:
      entity_id: all
    service: cover.close_cover
  mode: single
- id: '1576675828079'
  alias: Presence - Nobody home
  description: ''
  trigger:
  - entity_id: group.all_persons
    from: home
    platform: state
    to: not_home
  condition: []
  action:
  - data:
      message: Nobody is home right now
    service: notify.mobile_app_toms_phone
- id: '1576676147603'
  alias: 'Lights on: Nobody home and lights on (repeat)'
  description: ''
  trigger:
  - entity_id: group.all_persons
    for: 00:02:00
    from: home
    platform: state
    to: not_home
  condition:
  - condition: state
    entity_id: binary_sensor.lights_are_on
    state: 'on'
  - condition: state
    entity_id: input_boolean.do_not_disturb
    state: 'off'
  action:
  - repeat:
      sequence:
      - service: notify.tom_and_anna
        data:
          data:
            tag: lights-repeat
            actions:
            - action: LIGHTS_OFF
              title: Turn off lights
          title: Lights are on
          message: "\U0001F4A1 Nobody is home but lights have been left on . I'll
            remind you every 15 minutes."
      - delay:
          minutes: 15
      until:
      - condition: state
        entity_id: binary_sensor.lights_are_on
        state: 'off'
  mode: single
- id: '1576773012546'
  alias: Presence - Somebody arrived home
  description: ''
  trigger:
  - entity_id: group.all_persons
    from: not_home
    platform: state
    to: home
  condition: []
  action:
  - data:
      message: "{%- for person in states.group.all_persons.attributes.entity_id -%}\n
        \ {%- if is_state(person, 'home') -%} \n    {{ state_attr(person, 'friendly_name')
        }} just arrived home\n  {%- endif -%}\n{%- endfor -%} \n"
    service: notify.mobile_app_toms_phone
  mode: single
- id: '1576773914306'
  alias: 'Lights: Handle "Lights Off" command'
  description: Respond to command from mobeil app notification to turn off all lights
  trigger:
  - platform: event
    event_type: mobile_app_notification_action
    event_data:
      action: LIGHTS_OFF
  condition: []
  action:
  - data:
      entity_id: all
    service: light.turn_off
  - service: notify.tom_and_anna
    data:
      message: All lights turned off.
  mode: single
- id: '1577980276286'
  alias: Presence - Left work
  description: Send a notification when Tom or Anna has been away from work for 2
    minutes
  trigger:
  - entity_id: person.tom
    for: 00:02:00
    from: BJSS
    platform: state
    to: not_home
    id: tom
  - entity_id: person.anna
    for: 00:02:00
    from: AD Work
    platform: state
    to: not_home
    id: anna
  condition:
  - after: '15:30:00'
    condition: time
  action:
  - service: notify.mobile_app_toms_phone
    data:
      message: '{{ state_attr(trigger.entity_id, ''friendly_name'') }} left work 2
        minutes ago.'
- id: '1578592845893'
  alias: 'Presence: Left Leeds Station'
  description: Send a notification 2 mins after Tom or Anna has left Leeds station
  trigger:
  - entity_id:
    - person.tom
    for:
      hours: 0
      minutes: 2
      seconds: 0
    from: Leeds Station
    platform: state
    id: tom
  - entity_id:
    - person.anna
    for:
      hours: 0
      minutes: 2
      seconds: 0
    from: Leeds Station
    platform: state
    id: anna
  condition:
  - after: '16:30'
    condition: time
    enabled: true
  action:
  - service: notify.mobile_app_toms_phone
    data:
      message: '{{ state_attr(trigger.entity_id, ''friendly_name'') }} left Leeds
        Station 2 minutes ago.'
  - condition: trigger
    id:
    - tom
  - service: notify.mobile_app_anna_s_phone
    data:
      message: '{{ state_attr(trigger.entity_id, ''friendly_name'') }} left Leeds
        Station 2 minutes ago.'
- id: '1580903225785'
  alias: 'Presence: Greeting'
  description: Play a greeting when Tom arrives home
  trigger:
  - entity_id: person.tom
    from: not_home
    platform: state
    to: home
  condition: []
  action:
  - delay: 00:00:30
  - data:
      message: Hello Tom, {{ states('sensor.compliment') }}
    entity_id: media_player.hallway_home
    service: tts.google_translate_say
- id: '1580921419430'
  alias: 'Trains: Update Next LDS-SHY train'
  description: Between the hours of 16:00 and 18:00 update the LDS-SHY train sensor
    every 15 minutes
  trigger:
  - hours: '16'
    minutes: /2
    platform: time_pattern
  - hours: '17'
    minutes: /15
    platform: time_pattern
  condition: []
  action:
  - entity_id: sensor.next_train_to_shy
    service: homeassistant.update_entity
- id: '1580923110072'
  alias: 'Trains: Update Next SHY-LDS train'
  description: Between the hours of 07:00 and 09:00 update the SHY-LDS train sensor
  trigger:
  - hours: '07'
    minutes: /2
    platform: time_pattern
  - hours: 08
    minutes: /15
    platform: time_pattern
  condition: []
  action:
  - entity_id: sensor.next_train_to_lds
    service: homeassistant.update_entity
- id: '1580937267396'
  alias: 'TV: Dim lights when playing'
  description: ''
  trigger:
  - entity_id:
    - media_player.kodi_pi
    - media_player.kodi_halo
    - media_player.halo
    platform: state
    to: playing
    id: kodi
  - platform: state
    entity_id:
    - media_player.living_room_tv
    to: playing
    id: chromecast
  condition:
  - condition: state
    entity_id: light.living_room
    state: 'on'
  action:
  - choose:
    - conditions:
      - condition: and
        conditions:
        - condition: trigger
          id: kodi
        - condition: numeric_state
          entity_id: sun.sun
          attribute: elevation
          below: -2
      sequence:
      - data:
          brightness_pct: 15
          transition: 3
        target:
          entity_id: light.living_room
        action: light.turn_on
    - conditions:
      - condition: trigger
        id: kodi
      sequence:
      - data:
          brightness_pct: 5
          transition: 3
        target:
          entity_id: light.living_room
        action: light.turn_on
    - conditions:
      - condition: trigger
        id: chromecast
      sequence:
      - data:
          brightness_pct: 40
        target:
          entity_id: light.living_room
        action: light.turn_on
    default: []
- id: '1580937548623'
  alias: 'Kodi: Brighten lights when stop playing'
  description: ''
  trigger:
  - entity_id:
    - media_player.kodi_pi
    - media_player.living_room_tv
    - media_player.halo
    - media_player.kodi_halo
    from: playing
    platform: state
    to: paused
    for:
      hours: 0
      minutes: 0
      seconds: 0
  - entity_id:
    - media_player.kodi_pi
    - media_player.living_room_tv
    - media_player.halo
    - media_player.kodi_halo
    from: playing
    platform: state
    to: idle
    for:
      hours: 0
      minutes: 0
      seconds: 2
  - entity_id:
    - media_player.kodi_pi
    - media_player.living_room_tv
    - media_player.halo
    - media_player.kodi_halo
    from: paused
    platform: state
    to: idle
  condition:
  - condition: state
    entity_id: light.living_room
    state: 'on'
  action:
  - data:
      brightness: 200
    entity_id: light.living_room_1, light.living_room_2
    action: light.turn_on
  mode: single
- id: '1581026602537'
  alias: 'Dehumidifier: Turn on'
  description: Turn on when humidity above 80
  trigger:
  - above: 80
    entity_id: sensor.ensuite_humidity
    platform: numeric_state
  condition: []
  action:
  - data: {}
    entity_id: switch.dehumidifier
    service: switch.turn_on
- id: '1581026980222'
  alias: 'Dehumidifier: Turn off'
  description: Turn off when humidity below 70 for 5 minutes
  trigger:
  - below: 70
    entity_id: sensor.ensuite_humidity
    for: 00:05:00
    platform: numeric_state
  condition:
  - condition: state
    entity_id: switch.dehumidifier
    state: 'on'
  action:
  - entity_id: switch.dehumidifier
    service: switch.turn_off
- id: '1581757504089'
  alias: Printer - Notify when complete
  description: Send an app notification with photo and broadcast to Google Home when
    Printer is done
  trigger:
  - entity_id: binary_sensor.octoprint_printing
    from: 'on'
    platform: state
    to: 'off'
  condition:
  - condition: numeric_state
    entity_id: sensor.octoprint_job_percentage
    above: '95'
  - condition: state
    entity_id: input_boolean.do_not_disturb
    state: 'off'
  action:
  - data:
      entity_id: media_player.living_room_display
      message: The 3D printer has finished
    service: tts.google_translate_say
  - service: notify.mobile_app_toms_phone
    data:
      message: The 3D Printer has finished
      data:
        image: /api/camera_proxy/camera.octoprint
        actions:
        - action: URI
          title: View live camera
          uri: lovelace/printer
  mode: single
- id: '1581776307274'
  alias: 'Washer: Notify done (repeat)'
  description: ''
  trigger:
  - minutes: /15
    platform: time_pattern
  condition:
  - condition: template
    value_template: '{{ as_timestamp(now()) - as_timestamp(states.binary_sensor.washer.last_changed)
      > 10*60 }}'
  - condition: state
    entity_id: input_boolean.do_not_disturb
    state: 'off'
  action:
  - data:
      entity_id:
      - media_player.living_room_display
      - media_player.hallway_home
      message: The washing machine finished {{ relative_time(states.binary_sensor.washer.last_changed)
        }} ago, please hang out the washing
    service: tts.google_translate_say
  - data:
      title: Washing Machine
      message: "\U0001F9FA The washing machine finished {{ relative_time(states.binary_sensor.washer.last_changed)
        }} ago, please hang out the washing"
      data:
        actions:
        - action: WASHER_EMPTIED
          title: Washer emptied
        group: Washing machine
        channel: WashingMachine
        tag: washer-repeat
    service: notify.tom_and_anna
  mode: single
- id: '1581777155699'
  alias: 'Washer: Machine finished'
  description: ''
  trigger:
  - entity_id: binary_sensor.washer
    from: 'on'
    platform: state
    to: 'off'
  condition: []
  action:
  - entity_id: automation.washer_notify_done
    service: automation.turn_on
  - data:
      entity_id:
      - media_player.living_room_display
      - media_player.kitchen_display
      - media_player.office_wifi
      message: The washing machine has finished.
    service: tts.google_translate_say
  - service: notify.tom_and_anna
    data:
      title: Washing Machine
      message: "\U0001F9FA The washing machine has finished, please hang out the washing"
      data:
        actions:
        - action: WASHER_EMPTIED
          title: Washer emptied
        group: Washing machine
        channel: WashingMachine
        vibrationPattern: 10, 100, 500, 100, 500, 500
  mode: single
- id: '1581777529393'
  alias: 'Washer: Handle *washer_emptied* notification response'
  description: ''
  trigger:
  - platform: event
    event_type: mobile_app_notification_action
    event_data:
      action: WASHER_EMPTIED
  - platform: tag
    tag_id: 1871444b-f9e8-4e6f-9f0f-8310cae21918
  condition: []
  action:
  - entity_id: automation.washer_notify_done
    service: automation.turn_off
  - data:
      title: Washing Machine
      message: '{{weather_icons[states(''weather.forecast_home'')]}}Great! The forecast
        for today is: {{ state_attr(''weather.forecast_home'', ''temperature'') }}°C,
        {{ states(''weather.forecast_home'')}}. Wind speed is {{ state_attr(''weather.forecast_home'',
        ''wind_speed'') }}km/h.'
      data:
        group: Washing machine
        channel: WashingMachine
    service: notify.tom_and_anna
  variables:
    weather_icons:
      cloudy: ☁️
      rainy: "\U0001F326️"
      windy: "\U0001F4A8"
      sunny: ☀️
      lightning: "\U0001F329️"
      hail: "\U0001F9CA"
      fog: "\U0001F32B️"
      snowy: ❄️
      partlycloudy: ⛅
  mode: single
- id: '1582836882523'
  alias: Blanket - turn off TD after 15m
  description: Turn off Toms blanket 15m after it is turned on
  trigger:
  - entity_id: switch.blanket_tom
    for: 00:15:00
    from: 'off'
    platform: state
    to: 'on'
  condition: []
  action:
  - data: {}
    entity_id: switch.blanket_tom
    service: switch.turn_off
  mode: single
- id: '1586469687141'
  alias: 'Globe: turn off after 30m'
  description: ''
  trigger:
  - entity_id: switch.sonoff_1000d4baef_1
    for: 00:30:00
    from: 'off'
    platform: state
    to: 'on'
  condition: []
  action:
  - data: {}
    entity_id: switch.sonoff_1000d4baef_1
    service: switch.turn_off
- id: '1588449990654'
  alias: 'Garage: Notification (repeat)'
  description: At 15 min intervals play/send a reminder notification
  trigger:
  - type: opened
    platform: device
    device_id: 95b859a2f9f711eaa43c6ba5d5c98dd1
    entity_id: binary_sensor.garage_door
    domain: binary_sensor
    for:
      hours: 0
      minutes: 15
      seconds: 0
      milliseconds: 0
  condition:
  - condition: state
    entity_id: input_boolean.do_not_disturb
    state: 'off'
  action:
  - repeat:
      sequence:
      - service: tts.google_translate_say
        data:
          entity_id:
          - media_player.living_room_display
          - media_player.hallway_home
          message: The garage door was opened {{ relative_time(states.binary_sensor.garage_door.last_changed)
            }} ago.
      - service: notify.tom_and_anna
        data:
          title: Garage door
          message: The garage door was opened {{ relative_time(states.binary_sensor.garage_door.last_changed)
            }} ago
          data:
            group: Garage
            channel: Garage
            tag: garage-repeat
      - delay:
          minutes: 15
      until:
      - condition: state
        entity_id: binary_sensor.garage_door
        state: 'off'
  mode: single
- id: '1588450174191'
  alias: 'Garage: Open'
  description: ''
  trigger:
  - type: opened
    platform: device
    device_id: 95b859a2f9f711eaa43c6ba5d5c98dd1
    entity_id: binary_sensor.garage_door
    domain: binary_sensor
  condition: []
  action:
  - data:
      title: Garage door
      message: The garage door was opened
      data:
        group: Garage
        channel: Garage
        vibrationPattern: 10, 100, 500, 100, 500, 500
    service: notify.mobile_app_toms_phone
  - data:
      entity_id:
      - media_player.living_room_display
      - media_player.hallway_home
      message: The garage door was opened
    service: tts.google_translate_say
  mode: single
- id: '1588450370943'
  alias: 'Garage: Closed'
  description: ''
  trigger:
  - platform: state
    entity_id:
    - binary_sensor.garage_door
    from: 'on'
    to: 'off'
  condition: []
  action:
  - data:
      entity_id: media_player.living_room_display
      message: The garage door was closed
      cache: false
    service: tts.google_translate_say
  mode: single
- id: '1589231983089'
  alias: 'Kodi: Turn off power after shutdown'
  description: ''
  trigger:
  - entity_id: media_player.kodi
    platform: state
    to: 'off'
    for: 00:00:30
  condition: []
  action:
  - type: turn_off
    device_id: 5bb82585d208d7e31acd3eb432345e59
    entity_id: switch.media_centre
    domain: switch
  mode: single
- id: '1604160427345'
  alias: 'Lights: Turn on boys'' light when motion'
  description: ''
  trigger:
  - type: motion
    platform: device
    device_id: b5a3bd7d5d4541f7962db7fbdce9a670
    entity_id: binary_sensor.seb_d1_motion
    domain: binary_sensor
  - type: motion
    platform: device
    device_id: e8cd43fe0f2842bca71d1ee8b5adc5da
    entity_id: binary_sensor.reu_d1_motion
    domain: binary_sensor
  condition:
  - condition: or
    conditions:
    - condition: time
      after: 07:30
      before: 08:30:00
    - condition: time
      after: '17:00'
      before: '20:00'
    - condition: time
      after: 07:30:00
      before: '20:00:00'
      weekday:
      - sat
      - sun
  action:
  - service: light.turn_on
    data:
      entity_id: '{{ light_map[trigger.entity_id] }}'
      color_name: wheat
  variables:
    light_map:
      binary_sensor.seb_d1_motion:
      - light.sebs_ceiling
      - light.sebs_lamp
      binary_sensor.reu_d1_motion: light.reubens_ceiling
  mode: single
- id: '1590597141876'
  alias: 'Lights: Turn off boys'' light when no motion'
  description: ''
  triggers:
  - entity_id:
    - binary_sensor.seb_d1_motion
    for:
      hours: 0
      minutes: 10
      seconds: 0
    to: 'off'
    trigger: state
    from: 'on'
    id: seb
  - entity_id:
    - binary_sensor.reu_d1_motion
    for:
      hours: 0
      minutes: 10
      seconds: 0
    to: 'off'
    trigger: state
    from: 'on'
    id: reu
  conditions:
  - after: 07:30
    condition: time
    before: '19:30'
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - seb
      sequence:
      - action: light.turn_off
        metadata: {}
        data: {}
        target:
          entity_id:
          - light.sebs_lamp
          - light.sebs_ceiling
          - light.sebs_floorlamp
    - conditions:
      - condition: trigger
        id:
        - reu
      sequence:
      - action: light.turn_off
        metadata: {}
        data: {}
        target:
          entity_id:
          - light.reubens_ceiling
          - light.rname
  mode: single
- id: '1592899929119'
  alias: 'Lights: Turn off all bedroom lights at 8am'
  description: ''
  trigger:
  - at: 08:00:00
    platform: time
  condition: []
  action:
  - service: light.turn_off
    metadata: {}
    data: {}
    target:
      entity_id:
      - light.rname
      - light.sebs_lamp
      - light.sebs_floorlamp
      - light.main_bedroom_ceiling
      - light.sebs_ceiling
      - light.main_bedroom_bloom
      - light.reubens_ceiling
  mode: single
- id: '1600335652412'
  alias: ESP32 Cam timelapse
  description: ''
  trigger:
  - entity_id: switch.esp32cam_status
    from: 'off'
    platform: state
    to: 'on'
  condition:
  - after: sunrise
    before: sunset
    condition: sun
  action:
  - data:
      value: '{{ states(''sensor.date'') }}_{{ states(''sensor.time'') }}'
    entity_id: input_text.image_timestamp
    service: input_text.set_value
  - data:
      entity_id: camera.esp32cam_one
      filename: /config/www/cams/esp32cam_{{ states('input_text.image_timestamp')
        }}.jpg
    entity_id: camera.esp32cam_one
    service: camera.snapshot
  - delay: 00:00:02
  - data:
      entity_id: camera.esp32cam_lastimage
      file_path: /config/www/cams/esp32cam_{{ states('input_text.image_timestamp')
        }}.jpg
    service: local_file.update_file_path
  mode: single
- id: handle_tag_scan
  alias: 'NFC: Media Player'
  trigger:
  - platform: event
    event_type: tag_scanned
  condition:
  - condition: template
    value_template: '{{ trigger.event.data.tag_id in tags }}'
  - condition: template
    value_template: '{{ trigger.event.data.device_id in media_players }}'
  - condition: template
    value_template: '{{ states(''sensor.time'') < states(''input_datetime.boys_bedtime'')
      }}'
  action:
  - variables:
      media_player_entity_id: '{{ media_players[trigger.event.data.device_id] }}'
      media_content_id: '{{ tags[trigger.event.data.tag_id].media_content_id }}'
      media_content_type: '{{ tags[trigger.event.data.tag_id].media_content_type }}'
  - service: media_player.volume_set
    data:
      volume_level: 0.5
      entity_id: '{{ media_player_entity_id }}'
  - service: media_player.play_media
    data:
      entity_id: '{{ media_player_entity_id }}'
      media_content_id: '{{ media_content_id }}'
      media_content_type: '{{ media_content_type }}'
  - delay: 5
  mode: single
  variables:
    media_players:
      43ddd1e400d41d9d547f7bc24a95f86d: media_player.reuben_s_room_speaker
      4dd136882e204aec5b9809887714f25b: media_player.seb_s_home
    tags:
      04-CB-A6-D2-78-6B-80:
        media_content_id: https://tdroza.duckdns.org/local/bomb.mp3
        media_content_type: music
        title: Fact Bomb!
      04-5C-6E-AA-ED-6C-80:
        media_content_id: https://firebasestorage.googleapis.com/v0/b/storytime-7c623.appspot.com/o/stories%2F4Z0FQvDMnNyIOtJeBa93%2Frecordings%2FHzFp8GQRWwFEbkB4hSLw%2Frecordings%2Faudio.mp3?alt=media&token=b107fb98-e8af-4d60-908c-3be902cc76f6
        media_content_type: music
        title: Star Wars
      04-2F-8B-FA-90-49-81:
        media_content_id: https://firebasestorage.googleapis.com/v0/b/storytime-7c623.appspot.com/o/stories%2FqBdQcfPIY4UJfmVC4mqj%2Frecordings%2FBZFoJspmw9K9IwlQMz8J%2Frecordings%2Faudio.mp3?alt=media&token=f46db5de-43c6-4283-9e61-1397aa1ac46d
        media_content_type: music
      0e179e79-1604-4fc8-bb2c-4b28a59f9ea1:
        media_content_id: https://firebasestorage.googleapis.com/v0/b/storytime-7c623.appspot.com/o/stories%2FqBdQcfPIY4UJfmVC4mqj%2Frecordings%2FBZFoJspmw9K9IwlQMz8J%2Frecordings%2Faudio.mp3?alt=media&token=f46db5de-43c6-4283-9e61-1397aa1ac46d
        media_content_type: music
      04-B0-A4-EA-41-2B-80:
        media_content_id: https://firebasestorage.googleapis.com/v0/b/storytime-7c623.appspot.com/o/stories%2F6WI5vrqc6snoccsxsUV2%2Frecordings%2FTdQPRZxJpMG8w6xA3asa%2Frecordings%2Faudio.mp3?alt=media&token=ee3e9093-f4b5-44c6-8571-f362cc2a884c
        media_content_type: music
      b8777c03-86f1-48cd-a844-d14bb6d0a59e:
        media_content_id: https://firebasestorage.googleapis.com/v0/b/storytime-7c623.appspot.com/o/stories%2F6WI5vrqc6snoccsxsUV2%2Frecordings%2FTdQPRZxJpMG8w6xA3asa%2Frecordings%2Faudio.mp3?alt=media&token=ee3e9093-f4b5-44c6-8571-f362cc2a884c
        media_content_type: music
        title: The Bear, The Piano, The Dog and the Fiddle
      B9-17-08-8E:
        media_content_id: https://chtbl.com/track/43774/traffic.megaphone.fm/SONY2917056284.mp3
        media_content_type: music
      87-61-95-5F:
        media_content_id: https://www.dropbox.com/s/uowksapxv8nb8se/08%20-%20Come%20What%20May.mp3?dl=1
        media_content_type: music
      04-0F-81-FA-90-49-81:
        media_content_id: https://firebasestorage.googleapis.com/v0/b/storytime-7c623.appspot.com/o/stories%2FGH4ZnxM7M8oxbVZEmV4T%2Frecordings%2FOZljR1hXy7orkCBrha9f%2Frecordings%2Faudio.mp3?alt=media&token=9d6f367f-4521-4e0b-9b7d-66500f2ef836
        media_content_type: music
      04-1B-81-FA-90-49-81:
        media_content_id: https://firebasestorage.googleapis.com/v0/b/storytime-7c623.appspot.com/o/stories%2FZTe10kJMfXgNaiSCsStC%2Frecordings%2FKksLQS6LUXWLrBbtDusZ%2Frecordings%2Faudio.mp3?alt=media&token=46232d75-e430-4b11-a532-4185a96a34dd
        media_content_type: music
        title: What the Ladybird Heard
      04-27-81-FA-90-49-81:
        media_content_id: https://firebasestorage.googleapis.com/v0/b/storytime-7c623.appspot.com/o/stories%2F0CSxJ7wAn8p7s6adeqAx%2Frecordings%2F82kgp14YF6iJtU77IaSd%2Frecordings%2Faudio.mp3?alt=media&token=68bdd707-2f64-47a6-9887-8b86dd6b73d4
        media_content_type: music
        title: Tiddler
      04-21-81-FA-90-49-81:
        media_content_id: https://firebasestorage.googleapis.com/v0/b/storytime-7c623.appspot.com/o/stories%2FvGG2EXQ9sp2HOS9f74UB%2Frecordings%2FfKgkUvjMMQZYIM5XT2Wd%2Frecordings%2Faudio.mp3?alt=media&token=096ef499-c35d-44fa-a9eb-2c9ca5cb9ec0
        media_content_type: music
        title: Lady of Shallot
      04-7E-6E-62-90-6B-80:
        media_content_id: https://firebasestorage.googleapis.com/v0/b/storytime-7c623.appspot.com/o/stories%2FEfVUE7f9cD3ggPOJG3WG%2Frecordings%2F5YLWhtixOsEX4ju064js%2Frecordings%2Faudio.mp3?alt=media&token=60cd78ce-af61-4982-86b7-604a6ddf7985
        media_content_type: music
        title: Zog and the Flying Doctors
      04-15-81-FA-90-49-81:
        media_content_id: https://firebasestorage.googleapis.com/v0/b/storytime-7c623.appspot.com/o/stories%2FQkcZLdHAK2DgO8L8FDgG%2Frecordings%2FDGc9pUmUPbzHwhAvImCc%2Frecordings%2Faudio.mp3?alt=media&token=2e7a5558-c610-44d8-b03f-534e0b1f2a24
        media_content_type: music
        title: Monkey Puzzle
      04-82-6E-62-90-6B-80:
        media_content_id: https://firebasestorage.googleapis.com/v0/b/storytime-7c623.appspot.com/o/stories%2F6aOQWFLcP8N40QSpBiVL%2Frecordings%2Frxu1QkpPKd9wYwX2094m%2Frecordings%2Faudio.mp3?alt=media&token=964f2092-cd0d-4f29-a0f9-cbd1cc3670a3
        media_content_type: music
        title: The Snail and the Whale
      04-64-7F-62-EC-6B-81:
        media_content_id: https://firebasestorage.googleapis.com/v0/b/storytime-7c623.appspot.com/o/stories%2FWAmgOrvRTRaoApufBwFJ%2Frecordings%2F8OwDv4WuCySO2j6tBAkd%2Frecordings%2Faudio.mp3?alt=media&token=b34ac6ea-9052-4a30-9f86-788f7a39e438
        media_content_type: music
        title: Peace at last
      04-68-7F-62-EC-6B-81:
        media_content_id: https://firebasestorage.googleapis.com/v0/b/storytime-7c623.appspot.com/o/stories%2FtfRd0ncTBChvgHQM0jjk%2Frecordings%2Fa7VgLNATEVtB6P3avoE3%2Frecordings%2Faudio.mp3?alt=media&token=5cdd84c4-2930-4bec-bfd2-e48cc8d579a6
        media_content_type: music
      04-7A-6E-62-90-6B-80:
        media_content_id: https://firebasestorage.googleapis.com/v0/b/storytime-7c623.appspot.com/o/stories%2F6WD7fy4W11bVKV2Gd8o9%2Frecordings%2FCToJUbTb6lN9gitTkCNd%2Frecordings%2Faudio.mp3?alt=media&token=065cf49f-b8bc-4ba3-9cb4-304d2ebd64ff
        media_content_type: music
      04-76-6E-62-90-6B-80:
        media_content_id: https://firebasestorage.googleapis.com/v0/b/storytime-7c623.appspot.com/o/stories%2Fo2FeQfUcl5rRgzEkitho%2Frecordings%2F6OgP7oT0UzA6O0OGZUYB%2Frecordings%2Faudio.mp3?alt=media&token=98a53f04-c488-408f-bf77-49c20fea70c8
        media_content_type: music
        title: Aussie Hokey Pokey
      04-11-6F-AA-ED-6C-80:
        media_content_id: https://firebasestorage.googleapis.com/v0/b/storytime-7c623.appspot.com/o/stories%2Fr6uZZnI0groNWT5WZ7Q6%2Frecordings%2FtbH0tAPWPRNQwqERZPDV%2Frecordings%2Faudio.mp3?alt=media&token=59870357-8fa9-42ec-b3f2-427bd507aa59
        media_content_type: music
        title: The Very Hungry Bear
      04-21-6F-AA-ED-6C-80:
        media_content_id: https://firebasestorage.googleapis.com/v0/b/storytime-7c623.appspot.com/o/stories%2FxYIn8pzCyYeS10gdtQu2%2Frecordings%2FxcvKHkKYr9CAE4x92SNO%2Frecordings%2Faudio.mp3?alt=media&token=f76abe00-e319-442f-9005-a369c8beb3e1
        media_content_type: music
        title: Sugarlump & The Unicorn
      04-15-6F-AA-ED-6C-80:
        media_content_id: https://firebasestorage.googleapis.com/v0/b/storytime-7c623.appspot.com/o/stories%2FxSY7s30WsI7vekKXEKDb%2Frecordings%2FfdxzoTGrxO4ZkgCiMiVy%2Frecordings%2Faudio.mp3?alt=media&token=8d1fe17f-d124-4ab8-a553-5e5941b754ec
        media_content_type: music
        title: The Cave
      04-19-6F-AA-ED-6C-80:
        media_content_id: https://firebasestorage.googleapis.com/v0/b/storytime-7c623.appspot.com/o/stories%2FtVyUc0pXJ2pyGYt9HXor%2Frecordings%2FDa0xO76KGBbbtC4TsrUG%2Frecordings%2Faudio.mp3?alt=media&token=ff9cc69d-ef39-4530-a29f-c681144f2c77
        media_content_type: music
        title: The Paper Dolls
      04-1D-6F-AA-ED-6C-80:
        media_content_id: https://firebasestorage.googleapis.com/v0/b/storytime-7c623.appspot.com/o/stories%2FiZ9ToRDmRaD9LjLDXNPf%2Frecordings%2F2CjY7QGcCibMzgbcSJP3%2Frecordings%2Faudio.mp3?alt=media&token=73b881c5-6ca7-4881-82f5-eec3169e2f3a
        media_content_type: music
        title: Snow Bears
      04-6C-6E-AA-ED-6C-80:
        media_content_id: https://firebasestorage.googleapis.com/v0/b/storytime-7c623.appspot.com/o/stories%2FqIPowPEK0tCVemQmpfwH%2Frecordings%2F3rwPo84uEi87pVZvA2cM%2Frecordings%2Faudio.mp3?alt=media&token=99739671-2b12-494a-bdf1-552678328217
        media_content_type: music
        title: Room on the broom
      04-83-6F-AA-ED-6C-80:
        media_content_id: https://firebasestorage.googleapis.com/v0/b/storytime-7c623.appspot.com/o/stories%2F1kMvM6x73qpu5kTE1DBh%2Frecordings%2FIo2EfTtgUOuNZrFu8dXg%2Frecordings%2Faudio.mp3?alt=media&token=45db828b-657b-4f81-a586-bbc4b4dd85ec
        media_content_type: music
        title: Bringing down the moon
      04-7F-6F-AA-ED-6C-80:
        media_content_id: https://firebasestorage.googleapis.com/v0/b/storytime-7c623.appspot.com/o/stories%2F9FurTGgHRm9ycvFjix6X%2Frecordings%2FIBfJxanebnWT8CZPRYTI%2Frecordings%2Faudio.mp3?alt=media&token=2af233f9-0bc9-46c1-af63-99017560556c
        media_content_type: music
        title: The Gruffalo
      04-77-6F-AA-ED-6C-80:
        media_content_id: https://firebasestorage.googleapis.com/v0/b/storytime-7c623.appspot.com/o/stories%2FXSe2PPsM5cZ1RGDyQQDg%2Frecordings%2Fb0oXZw8itwmUIw11vmRZ%2Frecordings%2Faudio.mp3?alt=media&token=9f0eb901-8a09-491a-ba2b-4b8a05587d1f
        media_content_type: music
        title: Alien Tea on Planet Zum-Zee
      04-73-6F-AA-ED-6C-80:
        media_content_id: https://firebasestorage.googleapis.com/v0/b/storytime-7c623.appspot.com/o/stories%2FJmpqpkXqfCBjrTm5S67I%2Frecordings%2FbuNFPC9gGbIIkZQokx1g%2Frecordings%2Faudio.mp3?alt=media&token=3215cdfe-9add-464d-8f92-e69b7737bedc
        media_content_type: music
        title: Dinky Donkey
      04-6C-7F-62-EC-6B-81:
        media_content_id: https://firebasestorage.googleapis.com/v0/b/storytime-7c623.appspot.com/o/stories%2F68Dfu5tTDPPeCXmUWivB%2Frecordings%2FGz1udqevXgaGvPoonUq4%2Frecordings%2Faudio.mp3?alt=media&token=c4a3ccff-07e5-4dca-8f5b-7db9bb08797b
        media_content_type: music
        title: Monty and Milli
- id: '1602617983905'
  alias: 'Zoom: Notify start/end call'
  description: ''
  trigger:
  - platform: state
    entity_id:
    - binary_sensor.teams_video
  condition: []
  action:
  - variables:
      images:
        on_air: 0,256,[0,0,0], 0,34,[255,0,0], 34,37,[255,255,255], 37,39,[255,0,0],
          39,[255,255,255], 40,43,[255,0,0], 43,[255,255,255], 44,49,[255,0,0], 49,52,[255,255,255],
          52,54,[255,0,0], 54,57,[255,255,255], 57,[255,0,0], 58,62,[255,255,255],
          62,65,[255,0,0], 65,[255,255,255], 66,69,[255,0,0], 69,[255,255,255], 70,[255,0,0],
          71,73,[255,255,255], 73,75,[255,0,0], 75,[255,255,255], 76,80,[255,0,0],
          80,[255,255,255], 81,84,[255,0,0], 84,[255,255,255], 85,87,[255,0,0], 87,[255,255,255],
          88,90,[255,0,0], 90,[255,255,255], 91,94,[255,0,0], 94,[255,255,255], 95,97,[255,0,0],
          97,[255,255,255], 98,101,[255,0,0], 101,[255,255,255], 102,[255,0,0], 103,[255,255,255],
          104,[255,0,0], 105,[255,255,255], 106,[255,0,0], 107,[255,255,255], 108,[255,0,0],
          109,111,[255,255,255], 111,[255,0,0], 112,[255,255,255], 113,116,[255,0,0],
          116,[255,255,255], 117,119,[255,0,0], 119,[255,255,255], 120,122,[255,0,0],
          122,[255,255,255], 123,126,[255,0,0], 126,[255,255,255], 127,129,[255,0,0],
          129,[255,255,255], 130,133,[255,0,0], 133,[255,255,255], 134,[255,0,0],
          135,[255,255,255], 136,[255,0,0], 137,[255,255,255], 138,[255,0,0], 139,[255,255,255],
          140,[255,0,0], 141,143,[255,255,255], 143,[255,0,0], 144,149,[255,255,255],
          149,151,[255,0,0], 151,[255,255,255], 152,154,[255,0,0], 154,158,[255,255,255],
          158,161,[255,0,0], 161,[255,255,255], 162,165,[255,0,0], 165,[255,255,255],
          166,[255,0,0], 167,[255,255,255], 168,170,[255,0,0], 170,172,[255,255,255],
          172,176,[255,0,0], 176,[255,255,255], 177,180,[255,0,0], 180,[255,255,255],
          181,183,[255,0,0], 183,[255,255,255], 184,186,[255,0,0], 186,[255,255,255],
          187,190,[255,0,0], 190,[255,255,255], 191,194,[255,0,0], 194,197,[255,255,255],
          197,199,[255,0,0], 199,[255,255,255], 200,203,[255,0,0], 203,[255,255,255],
          204,208,[255,0,0], 208,[255,255,255], 209,212,[255,0,0], 212,[255,255,255],
          213,[255,0,0], 214,217,[255,255,255], 217,[255,0,0], 218,[255,255,255],
          219,222,[255,0,0], 222,[255,255,255], 223,256,[255,0,0]
  - choose:
    - conditions:
      - condition: state
        entity_id: binary_sensor.teams_video
        state: 'on'
      sequence:
      - service: tts.google_translate_say
        data:
          message: Tom has started a zoom meeting
          entity_id: media_player.bedroom_2_speaker
          cache: false
        enabled: false
      - service: rest_command.matrix_image
        data:
          image: 0,256,[0,0,0], 0,34,[255,0,0], 34,37,[255,255,255], 37,39,[255,0,0],
            39,[255,255,255], 40,43,[255,0,0], 43,[255,255,255], 44,49,[255,0,0],
            49,52,[255,255,255], 52,54,[255,0,0], 54,57,[255,255,255], 57,[255,0,0],
            58,62,[255,255,255], 62,65,[255,0,0], 65,[255,255,255], 66,69,[255,0,0],
            69,[255,255,255], 70,[255,0,0], 71,73,[255,255,255], 73,75,[255,0,0],
            75,[255,255,255], 76,80,[255,0,0], 80,[255,255,255], 81,84,[255,0,0],
            84,[255,255,255], 85,87,[255,0,0], 87,[255,255,255], 88,90,[255,0,0],
            90,[255,255,255], 91,94,[255,0,0], 94,[255,255,255], 95,97,[255,0,0],
            97,[255,255,255], 98,101,[255,0,0], 101,[255,255,255], 102,[255,0,0],
            103,[255,255,255], 104,[255,0,0], 105,[255,255,255], 106,[255,0,0], 107,[255,255,255],
            108,[255,0,0], 109,111,[255,255,255], 111,[255,0,0], 112,[255,255,255],
            113,116,[255,0,0], 116,[255,255,255], 117,119,[255,0,0], 119,[255,255,255],
            120,122,[255,0,0], 122,[255,255,255], 123,126,[255,0,0], 126,[255,255,255],
            127,129,[255,0,0], 129,[255,255,255], 130,133,[255,0,0], 133,[255,255,255],
            134,[255,0,0], 135,[255,255,255], 136,[255,0,0], 137,[255,255,255], 138,[255,0,0],
            139,[255,255,255], 140,[255,0,0], 141,143,[255,255,255], 143,[255,0,0],
            144,149,[255,255,255], 149,151,[255,0,0], 151,[255,255,255], 152,154,[255,0,0],
            154,158,[255,255,255], 158,161,[255,0,0], 161,[255,255,255], 162,165,[255,0,0],
            165,[255,255,255], 166,[255,0,0], 167,[255,255,255], 168,170,[255,0,0],
            170,172,[255,255,255], 172,176,[255,0,0], 176,[255,255,255], 177,180,[255,0,0],
            180,[255,255,255], 181,183,[255,0,0], 183,[255,255,255], 184,186,[255,0,0],
            186,[255,255,255], 187,190,[255,0,0], 190,[255,255,255], 191,194,[255,0,0],
            194,197,[255,255,255], 197,199,[255,0,0], 199,[255,255,255], 200,203,[255,0,0],
            203,[255,255,255], 204,208,[255,0,0], 208,[255,255,255], 209,212,[255,0,0],
            212,[255,255,255], 213,[255,0,0], 214,217,[255,255,255], 217,[255,0,0],
            218,[255,255,255], 219,222,[255,0,0], 222,[255,255,255], 223,256,[255,0,0]
    - conditions:
      - condition: state
        entity_id: binary_sensor.teams_video
        state: 'off'
      sequence:
      - service: tts.google_translate_say
        data:
          message: Tom has ended a zoom meeting
          entity_id: media_player.bedroom_2_speaker
          cache: false
        enabled: false
  mode: single
- id: '1603313648727'
  alias: Bedtime - phone charging and radiator
  description: Turn off light, turn on lamp, set radiator to low when phone or watch
    starts charging
  trigger:
  - type: plugged_in
    platform: device
    device_id: 477d49fc145f319f69ea1a3b8857f6ea
    entity_id: binary_sensor.toms_phone_is_charging
    domain: binary_sensor
  - type: plugged_in
    platform: device
    device_id: c51d67872c3edb614fac7a32412e6d7c
    entity_id: binary_sensor.toms_watch_is_charging
    domain: binary_sensor
  - type: plugged_in
    platform: device
    device_id: f077cacd0f2cbb4b86567e2891d541e5
    entity_id: d7fc079832a774243bc42d0b9fcf7cc3
    domain: binary_sensor
  - type: plugged_in
    platform: device
    device_id: 7df9b28318e1f535b7d778b2ce767f41
    entity_id: 38647301ac793871e60d3d9bd8712fd7
    domain: binary_sensor
  condition:
  - condition: time
    after: '21:30'
    before: '23:30:00'
  - condition: or
    conditions:
    - condition: zone
      entity_id: person.anna
      zone: zone.home
    - condition: zone
      entity_id: person.tom
      zone: zone.home
  action:
  - data:
      temperature: 16
    target:
      entity_id: climate.main_bedroom_radiator_thermostat
    action: climate.set_temperature
  - if:
    - condition: state
      entity_id: light.main_bedroom_ceiling
      state: 'on'
    then:
    - type: turn_off
      device_id: f5cda250d456ab9d753117c612f812c4
      entity_id: d8d3d88474f3161c637f50a46ea6671d
      domain: light
    - type: turn_on
      device_id: b9c88a37811e285dc2b594f847e29cf1
      entity_id: 54674009d38a14ac7eb62dfed9b2cb3b
      domain: light
  mode: single
- id: '1603396218827'
  alias: Tom's phone - smart charging
  description: Stop charging at 80%
  triggers:
  - type: battery_level
    device_id: 477d49fc145f319f69ea1a3b8857f6ea
    entity_id: sensor.toms_phone_battery_level
    domain: sensor
    above: 80
    trigger: device
  conditions:
  - condition: time
    after: '22:00'
  - condition: device
    type: is_on
    device_id: d06d0cd9a4d1df684a518b6183d5ea1f
    entity_id: cba274ca0aaf35bdde1082125786b1cf
    domain: switch
  actions:
  - type: turn_off
    device_id: d06d0cd9a4d1df684a518b6183d5ea1f
    entity_id: cba274ca0aaf35bdde1082125786b1cf
    domain: switch
  mode: single
- id: '1603396316886'
  alias: Tom's & Anna's phone - turn on charger AM and PM
  description: ''
  trigger:
  - platform: time
    at: '22:00:00'
  - platform: time
    at: 06:00:00
  condition:
  - condition: state
    entity_id: input_boolean.holiday_mode
    state: 'off'
  action:
  - type: turn_on
    device_id: 63119b10ea09a788da942a5fc8aa67ce
    entity_id: switch.annas_phone_charger
    domain: switch
  - type: turn_on
    device_id: d06d0cd9a4d1df684a518b6183d5ea1f
    entity_id: switch.toms_phone_charger
    domain: switch
  mode: single
- id: '1603396482626'
  alias: Tom's phone - turn off charger
  description: Turn off when fully charged or at 08:30
  triggers:
  - at: 08:30
    trigger: time
  - type: battery_level
    device_id: 477d49fc145f319f69ea1a3b8857f6ea
    entity_id: 3e73f1ade38098a05bc61ce0c592d789
    domain: sensor
    above: 99
    trigger: device
  - entity_id:
    - sensor.toms_phone_charger_type
    from: ac
    to: none
    for:
      hours: 0
      minutes: 0
      seconds: 10
    trigger: state
  - type: current
    device_id: d06d0cd9a4d1df684a518b6183d5ea1f
    entity_id: db66cd235fadf6f43c06f191388b2e7c
    domain: sensor
    below: 5
    for:
      hours: 0
      minutes: 0
      seconds: 30
    id: phone
    trigger: device
    enabled: true
  conditions:
  - condition: device
    type: is_on
    device_id: d06d0cd9a4d1df684a518b6183d5ea1f
    entity_id: cba274ca0aaf35bdde1082125786b1cf
    domain: switch
  actions:
  - type: turn_off
    device_id: d06d0cd9a4d1df684a518b6183d5ea1f
    entity_id: cba274ca0aaf35bdde1082125786b1cf
    domain: switch
  mode: single
- id: '1603808684460'
  alias: Close the door
  description: Play a notification if door opened and not closed within 3 seconds
  trigger:
  - type: opened
    platform: device
    device_id: 95b939ecf9f711eaa1fdcd4b4a1dccc0
    entity_id: binary_sensor.living_room_door
    domain: binary_sensor
    for:
      hours: 0
      minutes: 0
      seconds: 5
  condition:
  - condition: state
    state: 'off'
    entity_id: input_boolean.do_not_disturb
  action:
  - service: media_player.play_media
    data:
      media_content_id: https://www.dropbox.com/s/mov0prp7j7ir437/Close.wav?dl=1
      media_content_type: music
    entity_id: media_player.living_room_display
  mode: single
- id: '1604341003387'
  alias: 'NFC: Podcast Player'
  trigger:
  - platform: event
    event_type: tag_scanned
  condition:
  - condition: template
    value_template: '{{ trigger.event.data.tag_id in tags }}'
  - condition: template
    value_template: '{{ trigger.event.data.device_id in media_players }}'
  - condition: template
    value_template: '{{ states(''sensor.time'') < states(''input_datetime.boys_bedtime'')
      }}'
    enabled: true
  action:
  - variables:
      number_of_podcasts: '{{ state_attr(tags[trigger.event.data.tag_id].sensor, ''entries'')
        | length }}'
      podcast_counter: '{{ tags[trigger.event.data.tag_id].podcast_counter }}'
      podcast_sensor: '{{ tags[trigger.event.data.tag_id].sensor }}'
      media_player_entity_id: '{{ media_players[trigger.event.data.device_id] }}'
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ states(podcast_counter) | int >= number_of_podcasts |
          int }}'
      sequence:
      - service: counter.set_value
        data:
          value: '{{ number_of_podcasts - 1}}'
          entity_id: '{{podcast_counter}}'
    default: []
  - service: media_player.volume_set
    data:
      volume_level: 0.5
      entity_id: '{{ media_player_entity_id }}'
  - service: tts.google_translate_say
    data:
      entity_id: '{{ media_player_entity_id }}'
      message: '{{tags[trigger.event.data.tag_id].title}} {{state_attr(podcast_sensor,''entries'')[states(podcast_counter)
        | int].title }}'
  - delay: 00:00:02
  - wait_template: '{{ states(media_player_entity_id) == ''idle'' }}'
    continue_on_timeout: true
    timeout: '10'
  - service: media_player.play_media
    data:
      media_content_id: '{{ (state_attr(podcast_sensor,''entries'')[states(podcast_counter)
        | int].links | selectattr(''rel'',''eq'',''enclosure'') | list)[0].href }}'
      media_content_type: music
      entity_id: '{{ media_player_entity_id }}'
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ states(podcast_counter) | int == 0 }} '
      sequence:
      - service: counter.set_value
        data:
          value: '{{ number_of_podcasts | int - 1 }}'
          entity_id: '{{podcast_counter}}'
    default:
    - service: counter.decrement
      data:
        entity_id: '{{podcast_counter}}'
  mode: restart
  variables:
    media_players:
      4dd136882e204aec5b9809887714f25b: media_player.seb_s_home
      43ddd1e400d41d9d547f7bc24a95f86d: media_player.reuben_s_room_speaker
    tags:
      04-41-6F-AA-ED-6C-80:
        title: Girl Tales
        podcast_counter: counter.podcast_girl_tales
        sensor: sensor.podcast_girl_tales
      04-49-6F-AA-ED-6C-80:
        title: Stories Podcast
        podcast_counter: counter.podcast_stories
        sensor: sensor.podcast_stories
      04-45-6F-AA-ED-6C-80:
        title: Brains On
        podcast_counter: counter.podcast_brains_on
        sensor: sensor.podcast_brains_on
      04-72-6E-62-90-6B-80:
        title: Finn Caspian
        podcast_counter: counter.podcast_finn_caspian
        sensor: sensor.podcast_finn_caspian
      2011897b-e41a-4d94-8bbb-a51004899ad8:
        title: But Why (Seb Ring)
        podcast_counter: counter.podcast_but_why
        sensor: sensor.podcast_but_why
      04-35-6F-AA-ED-6C-80:
        title: But Why
        podcast_counter: counter.podcast_but_why
        sensor: sensor.podcast_but_why
      04-58-6E-AA-ED-6C-80:
        title: Goodnight Stories for Rebel Girls
        podcast_counter: counter.podcast_goodnight_stories
        sensor: sensor.podcast_goodnight_stories
      04-7B-FC-EA-83-6B-80:
        title: Story Pirates (Reu Ring)
        podcast_counter: counter.podcast_story_pirates
        sensor: sensor.podcast_story_pirates
      04-55-6F-AA-ED-6C-80:
        title: Story Pirates
        podcast_counter: counter.podcast_story_pirates
        sensor: sensor.podcast_story_pirates
      04-51-6F-AA-ED-6C-80:
        title: Maddies Sound Explorers
        podcast_counter: counter.podcast_maddie_s_sound_explorers
        sensor: sensor.podcast_sound_explorers
      04-31-6F-AA-ED-6C-80:
        title: Marvellous Musical
        podcast_counter: counter.podcast_marvellous_musical
        sensor: sensor.podcast_marvellous_musical
      04-4D-6F-AA-ED-6C-80:
        title: Peace Out
        podcast_counter: counter.podcast_peace_out
        sensor: sensor.podcast_peace_out
- id: '1604656539815'
  alias: Turn on living room lights when door opened
  description: ''
  trigger:
  - type: opened
    platform: device
    device_id: 95b939ecf9f711eaa1fdcd4b4a1dccc0
    entity_id: binary_sensor.living_room_door
    domain: binary_sensor
  condition:
  - condition: sun
    after: sunset
  - condition: time
    before: '22:00'
  - condition: state
    entity_id: light.living_room
    state: 'off'
  action:
  - service: light.turn_on
    data: {}
    entity_id: light.living_room
  mode: single
- id: '1605894548414'
  alias: Tag Reuben's Name is scanned
  description: ''
  trigger:
  - platform: tag
    tag_id: 04-70-6E-AA-ED-6C-80
  - platform: tag
    tag_id: 04-B5-04-3A-25-6D-84
  condition: []
  action:
  - type: toggle
    device_id: e04b748fc61f7ca1d9a4a202ddcefe7a
    entity_id: light.rname
    domain: light
  mode: single
- id: '1608917499387'
  alias: Low battery level detection & notification for all battery sensors
  description: ''
  use_blueprint:
    path: sbyx/low-battery-level-detection-notification-for-all-battery-sensors.yaml
    input:
      day: 0
      threshold: 25
      exclude0: sensor.annas_phone_battery_level
      actions:
      - service: notify.mobile_app_toms_phone
        data:
          message: Low battery alert for {{sensors}}
        enabled: true
      exclude1: sensor.toms_phone_battery_level
      exclude2: sensor.annas_watch_battery_level
      exclude3: sensor.toms_watch_battery_level
- id: '1609885331052'
  alias: 'Lights: Turn off boys'' light at bedtime'
  description: ''
  trigger:
  - platform: time
    at: input_datetime.boys_bedtime
  condition: []
  action:
  - service: light.turn_on
    target:
      entity_id:
      - light.sebs_ceiling
    data:
      brightness: 25
      color_name: green
  - service: light.turn_on
    target:
      entity_id:
      - light.reubens_ceiling
    data:
      brightness: 25
      color_name: orange
  - delay:
      hours: 0
      minutes: 15
      seconds: 0
      milliseconds: 0
  - service: light.turn_off
    data: {}
    target:
      entity_id:
      - light.sebs_lamp
      - light.reubens_ceiling
      - light.sebs_ceiling
      - light.rname
      - light.sebs_floorlamp
  mode: restart
- id: '1611402292310'
  alias: 'Lights: turn on main bedroom light when door opens'
  description: ''
  trigger:
  - type: opened
    platform: device
    device_id: 95b8d0def9f711eaa7bd15994734a55a
    entity_id: binary_sensor.main_bedroom_door
    domain: binary_sensor
  condition:
  - condition: time
    before: '22:45:00'
    after: '15:00:00'
  - condition: numeric_state
    entity_id: sun.sun
    attribute: elevation
    below: -2
  - condition: state
    entity_id: binary_sensor.toms_phone_is_charging
    state: 'off'
  - condition: state
    entity_id: binary_sensor.annas_phone_is_charging
    state: 'off'
  - condition: state
    entity_id: binary_sensor.toms_watch_is_charging
    state: 'off'
  - condition: state
    entity_id: light.main_bedroom_light_group
    state: 'off'
  action:
  - service: light.turn_on
    data:
      brightness_pct: 80
    target:
      entity_id:
      - light.main_bedroom_ceiling
  - delay:
      hours: 0
      minutes: 7
      seconds: 0
      milliseconds: 0
  - service: light.turn_off
    data: {}
    target:
      entity_id:
      - light.main_bedroom_ceiling
      - light.test_bulb
  mode: restart
- id: '1611525664637'
  alias: 'Lights: turn off house button'
  description: ''
  trigger:
  - device_id: a98335e1b775a3c92d83494f43ab2647
    domain: zha
    platform: device
    type: remote_button_double_press
    subtype: remote_button_double_press
  - platform: tag
    tag_id: 57749803-d2b7-415d-a6fa-78f44205d0cc
  condition: []
  action:
  - service: light.turn_off
    entity_id: all
  mode: single
- id: '1611774100909'
  alias: 'Lights: Toggle Reuben''s light with Zigbee button'
  description: ''
  use_blueprint:
    path: SeanM/zha-aqara-wireless-mini-switch.yaml
    input:
      aqara_mini_switch: 2a892df040e90ca799578d576ddcc6ae
      button_single_press:
      - service: light.toggle
        data: {}
        entity_id: light.reubens_ceiling
      button_double_press:
      - service: light.toggle
        data: {}
        entity_id: light.rname
      button_long_press:
      - service: light.turn_on
        target:
          device_id: 61f89eb89fac9724606bb7e0ffc52c9b
        data:
          brightness_pct: 5
- id: '1616499915162'
  alias: Anna's phone - smart charging
  description: ''
  trigger:
  - type: battery_level
    platform: device
    device_id: f077cacd0f2cbb4b86567e2891d541e5
    entity_id: f4acaeaca566bee2541c3c63f955b4a3
    domain: sensor
    above: 80
  condition:
  - condition: device
    type: is_on
    device_id: 63119b10ea09a788da942a5fc8aa67ce
    entity_id: switch.annas_phone_charger
    domain: switch
  - condition: or
    conditions:
    - condition: time
      after: '22:00'
    - condition: time
      before: 02:00:00
  action:
  - type: turn_off
    device_id: 63119b10ea09a788da942a5fc8aa67ce
    entity_id: switch.annas_phone_charger
    domain: switch
  mode: single
- id: '1616500250252'
  alias: Anna's watch & phone - turn off charger
  description: Turn off when fully charged, when unplugged, or at 08:30
  trigger:
  - platform: time
    at: 08:30:00
    id: time
  - type: not_plugged_in
    platform: device
    device_id: 7df9b28318e1f535b7d778b2ce767f41
    entity_id: 38647301ac793871e60d3d9bd8712fd7
    domain: binary_sensor
    id: watch
    for:
      hours: 0
      minutes: 0
      seconds: 10
  - type: battery_level
    platform: device
    device_id: f077cacd0f2cbb4b86567e2891d541e5
    entity_id: f4acaeaca566bee2541c3c63f955b4a3
    domain: sensor
    above: 99
    id: phone
  - platform: state
    entity_id:
    - sensor.annas_phone_charger_type
    from: ac
    to: none
    for:
      hours: 0
      minutes: 0
      seconds: 5
    id: phone
  - type: power
    platform: device
    device_id: 63119b10ea09a788da942a5fc8aa67ce
    entity_id: 92768c30d7c50874118c0b9f594800fc
    domain: sensor
    below: 2
    for:
      hours: 0
      minutes: 0
      seconds: 10
    id: phone
    enabled: false
  - type: power
    platform: device
    device_id: b7ab635f3051f3c87e93b4b497b470ea
    entity_id: 0e8ceb13ceb9c50862c6e982a5e5055c
    domain: sensor
    below: 0.5
    for:
      hours: 0
      minutes: 1
      seconds: 0
    id: watch
    enabled: false
  condition:
  - condition: or
    conditions:
    - condition: and
      conditions:
      - condition: trigger
        id:
        - phone
      - condition: device
        type: is_on
        device_id: 63119b10ea09a788da942a5fc8aa67ce
        entity_id: eaead4516bf95c532b1b30ca83611ff3
        domain: switch
    - condition: and
      conditions:
      - condition: trigger
        id:
        - watch
      - condition: device
        type: is_on
        device_id: b7ab635f3051f3c87e93b4b497b470ea
        entity_id: 09a9cb7cf20ec52da102d4ee329c9d20
        domain: switch
    - condition: trigger
      id:
      - time
  action:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - phone
        - time
      sequence:
      - type: turn_off
        device_id: 63119b10ea09a788da942a5fc8aa67ce
        entity_id: eaead4516bf95c532b1b30ca83611ff3
        domain: switch
    - conditions:
      - condition: trigger
        id:
        - watch
        - time
      sequence:
      - type: turn_off
        device_id: b7ab635f3051f3c87e93b4b497b470ea
        entity_id: 09a9cb7cf20ec52da102d4ee329c9d20
        domain: switch
  mode: parallel
  max: 3
- id: '1618222807946'
  alias: 'NFC: Tag scanned after 20:30 plays bedtime message'
  description: Time cut-off is set by `input_datetime.boys_bedtime`
  trigger:
  - platform: event
    event_type: tag_scanned
  condition:
  - condition: template
    value_template: '{{ states(''sensor.time'') > states(''input_datetime.boys_bedtime'')
      }}'
  - condition: template
    value_template: '{{ trigger.event.data.device_id in media_players }}'
  action:
  - service: tts.google_translate_say
    data:
      entity_id: '{{ media_players[trigger.event.data.device_id] }}'
      message: Sorry, I can't play that for you because it's time to go to sleep
  mode: single
  variables:
    media_players:
      4dd136882e204aec5b9809887714f25b: media_player.seb_s_home
      43ddd1e400d41d9d547f7bc24a95f86d: media_player.reuben_s_room_speaker
- id: '1619433471864'
  alias: 'Lights: Boys'' wakeup light'
  description: Fade in ceiling lights 10min before wakeup time
  trigger:
  - platform: time
    at: input_datetime.boys_wakeup
  condition:
  - condition: state
    entity_id: binary_sensor.workday_sensor
    state: 'on'
  action:
  - service: light.turn_on
    data:
      transition: 600
      brightness_pct: 100
      color_name: wheat
    target:
      entity_id:
      - light.reubens_ceiling
      - light.sebs_ceiling
    enabled: true
  - service: light.turn_on
    data:
      transition: 600
      brightness_pct: 100
      color_name: wheat
    target:
      entity_id:
      - light.main_bedroom_bloom
  mode: single
- id: '1621850581589'
  alias: Close the fridge door
  description: ''
  trigger:
  - type: opened
    platform: device
    device_id: fbe90b70595bca42e7368c42573a812c
    entity_id: binary_sensor.fridge_door
    domain: binary_sensor
    for:
      hours: 0
      minutes: 1
      seconds: 0
      milliseconds: 0
  condition: []
  action:
  - repeat:
      while:
      - type: is_open
        condition: device
        device_id: fbe90b70595bca42e7368c42573a812c
        entity_id: binary_sensor.fridge_door
        domain: binary_sensor
      sequence:
      - service: tts.google_translate_say
        target:
          entity_id:
          - media_player.kitchen_chromecast
          - media_player.living_room_display
        data:
          message: Please close the fridge door
          entity_id: media_player.kitchen_chromecast
      - service: notify.tom_and_anna
        data:
          title: Fridge freezer door
          message: "\U0001F9CA The fridge or freezer door has been open for more than
            1 minute"
          data:
            tag: fridge-door-repeat
      - delay:
          seconds: 30
  mode: single
- id: '1625066107430'
  alias: 'Bins: Recycling notification'
  description: ''
  trigger:
  - platform: calendar
    event: start
    offset: '-13:0:0'
    entity_id: calendar.recycling
    id: recycling
  - platform: calendar
    event: start
    offset: '-13:0:0'
    entity_id: calendar.regular
    id: regular
  condition: []
  action:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - recycling
      sequence:
      - service: notify.tom_and_anna
        data:
          message: '♻ Recycling bin collection is due tomorrow. Don''t forget to put
            the bin out!    '
          title: Bin Collection
    - conditions:
      - condition: trigger
        id:
        - regular
      sequence:
      - service: notify.tom_and_anna
        data:
          title: Bin Collection
          message: "\U0001F5D1 Regular bin collection is due tomorrow. Don't forget
            to put the bin out! "
  mode: single
- id: '1626116356389'
  alias: 'Lights: Turn on TV Backlight'
  description: ''
  trigger:
  - platform: state
    entity_id: light.living_room_light_group
    for:
      hours: 0
      minutes: 0
      seconds: 5
    from: 'off'
    to: 'on'
  - platform: state
    entity_id:
    - select.living_room_activities
    from: power_off
    to: Watch a Movie
    enabled: true
  - platform: state
    entity_id:
    - select.living_room_activities
    from: power_off
    to: Watch TV
    enabled: true
  - platform: device
    device_id: 950cead3239f24a85e11164841b585b6
    domain: media_player
    entity_id: c4c429171cd810093748e765e3b24134
    type: turned_on
  - platform: device
    type: turned_on
    device_id: 427e7a9ff36f4bf621ea13ec82dbd04d
    entity_id: b107dddc5eef60160330d956f715d0bf
    domain: remote
  condition: []
  action:
  - service: light.turn_on
    target:
      device_id: 3e6c31ee1302701c6ed52132c128c57d
    data: {}
  mode: single
- id: '1626117606618'
  alias: 'Lights: Turn off TV Backlight'
  description: ''
  trigger:
  - platform: state
    entity_id:
    - select.living_room_activities
    from:
    to: power_off
  - platform: state
    entity_id: light.living_room_light_group
    from: 'on'
    to: 'off'
    for:
      hours: 0
      minutes: 0
      seconds: 0
  - platform: state
    entity_id:
    - remote.halo
    to:
    from: 'on'
    for:
      hours: 0
      minutes: 0
      seconds: 5
  condition:
  - condition: state
    entity_id: light.living_room_light_group
    state: 'off'
  action:
  - service: light.turn_off
    target:
      device_id: 3e6c31ee1302701c6ed52132c128c57d
    data: {}
  mode: single
- id: '1627329816479'
  alias: 'Lights: Hallway motion sensor'
  description: ''
  trigger:
  - platform: state
    entity_id: binary_sensor.hue_motion_sensor_motion
    from: 'off'
    to: 'on'
    id: Motion
  - type: no_motion
    platform: device
    device_id: 667e2d5ec0b25b71625f1f344472c575
    entity_id: 1591cd09781ed617e5e3e1b19a2edead
    domain: binary_sensor
    id: Clear
    for:
      hours: 0
      minutes: 2
      seconds: 0
  condition: []
  action:
  - target:
      area_id: b3e17bb69aba419bacc48dbbb6fa5f73
    data:
      brightness: 57
    action: light.turn_on
  - target:
      area_id: b3e17bb69aba419bacc48dbbb6fa5f73
    action: light.turn_off
    data: {}
  - type: turn_on
    device_id: edf3520719888be0aa26efc14b1ce101
    entity_id: 2df0efe30def236b7d598da9101e640b
    domain: light
  - choose:
    - conditions:
      - condition: trigger
        id:
        - Motion
      - condition: time
        before: '22:00:00'
      sequence:
      - action: light.turn_on
        metadata: {}
        data:
          brightness_pct: 100
        target:
          device_id: edf3520719888be0aa26efc14b1ce101
    - conditions:
      - condition: trigger
        id:
        - Motion
      - condition: time
        after: '22:00:00'
      sequence:
      - action: light.turn_on
        metadata: {}
        data:
          brightness_pct: 20
        target:
          device_id: edf3520719888be0aa26efc14b1ce101
    - conditions:
      - condition: trigger
        id:
        - Clear
      sequence:
      - type: turn_off
        device_id: edf3520719888be0aa26efc14b1ce101
        entity_id: 2df0efe30def236b7d598da9101e640b
        domain: light
  mode: restart
- id: '1627654587843'
  alias: Lights - Vacation Lighting
  description: ''
  use_blueprint:
    path: VacationLights/vacation_lights.yaml
    input:
      vacation_mode_toggle: input_boolean.holiday_mode
      replay_sensor_1: sensor.replay_hallway
      light_target_1: light.hallway
      replay_sensor_2: sensor.replay_living_room_lights
      light_target_2: light.living_room_light_group
      replay_sensor_3: sensor.replay_main_bedroom
      light_target_3: light.main_bedroom_ceiling
      replay_sensor_4: sensor.replay_main_bedroom_bloom
      light_target_4: light.main_bedroom_bloom
      replay_sensor_5: sensor.replay_reuben_ceiling
      light_target_5: light.reubens_ceiling
      replay_sensor_6: sensor.replay_sebs_ceiling
      light_target_6: light.sebs_ceiling
      replay_sensor_7: sensor.do_nothing
      light_target_7: sensor.do_nothing
      replay_sensor_8: sensor.do_nothing
      replay_sensor_9: sensor.do_nothing
      light_target_8: sensor.do_nothing
      light_target_9: sensor.do_nothing
      replay_sensor_10: sensor.do_nothing
      light_target_10: sensor.do_nothing
- id: '1637928927711'
  alias: 'Office: Turn on'
  description: Turn on desk, and lights
  trigger:
  - platform: time
    at: input_datetime.work_start
  condition:
  - condition: state
    entity_id: binary_sensor.workday_sensor
    state: 'on'
  - condition: state
    entity_id: input_boolean.holiday_mode
    state: 'off'
  action:
  - type: turn_on
    device_id: ff6d43722edd09515d79924ee9576312
    entity_id: 2df4ec6d77b615e006ddf9b94b2f2e11
    domain: switch
  - choose:
    - conditions:
      - condition: state
        entity_id: binary_sensor.workday_anna
        state: 'on'
      sequence:
      - type: turn_on
        device_id: b40eb804797ddfe20d5c56ae0b92c1a9
        entity_id: switch.annas_desk
        domain: switch
  - delay:
      hours: 0
      minutes: 15
      seconds: 0
      milliseconds: 0
  - data: {}
    target:
      entity_id: switch.toms_monitor_light
    action: switch.turn_on
  - condition: state
    entity_id: binary_sensor.workday_anna
    state: 'on'
  - choose:
    - conditions:
      - condition: state
        entity_id: binary_sensor.workday_anna
        state: 'on'
      sequence:
      - type: turn_on
        device_id: b4b84b4ae3fab4400b0e133c18da5980
        entity_id: light.annas_desk
        domain: light
        brightness_pct: 100
  mode: single
- id: '1637929014156'
  alias: 'Office: Turn off'
  description: Turn off lights and desk
  trigger:
  - platform: time
    at: '18:00'
  condition:
  - condition: state
    entity_id: binary_sensor.workday_sensor
    state: 'on'
  - condition: state
    entity_id: input_boolean.holiday_mode
    state: 'off'
  action:
  - type: turn_off
    device_id: ff6d43722edd09515d79924ee9576312
    entity_id: 2df4ec6d77b615e006ddf9b94b2f2e11
    domain: switch
  - type: turn_off
    device_id: b40eb804797ddfe20d5c56ae0b92c1a9
    entity_id: switch.annas_desk
    domain: switch
  mode: single
- id: '1641984337744'
  alias: 'NFC: Music player'
  description: Play music from YouTube Music when a tag is scanned
  trigger:
  - platform: event
    event_type: tag_scanned
  condition:
  - condition: template
    value_template: '{{ trigger.event.data.tag_id in tags }}'
  - condition: template
    value_template: '{{ trigger.event.data.device_id in media_players }}'
  - condition: template
    value_template: '{{ states(''sensor.time'') < states(''input_datetime.boys_bedtime'')
      }}'
  action:
  - variables:
      media_player_entity_id: '{{ media_players[trigger.event.data.device_id] }}'
      media_content_id: '{{ tags[trigger.event.data.tag_id].media_content_id }}'
      media_content_type: '{{ tags[trigger.event.data.tag_id].media_content_type }}'
  - service: media_player.volume_set
    data:
      volume_level: 0.5
    target:
      entity_id: '{{ media_player_entity_id }}'
  - service: media_player.select_source
    data:
      source: '{{ media_player_entity_id }}'
      entity_id: media_player.ytube_music_player
  - service: media_player.volume_set
    data:
      volume_level: 0.3
    target:
      entity_id: '{{ media_player_entity_id }}'
  - service: media_player.play_media
    data:
      entity_id: media_player.ytube_music_player
      media_content_id: '{{ media_content_id }}'
      media_content_type: '{{ media_content_type }}'
  mode: single
  variables:
    media_players:
      43ddd1e400d41d9d547f7bc24a95f86d: media_player.reuben_s_room_speaker
      4dd136882e204aec5b9809887714f25b: media_player.seb_s_home
    tags:
      04-29-6F-AA-ED-6C-80:
        media_content_id: PLbNmRtwuOMuihM4wbhdfbhyvnoHt5Rs0P
        media_content_type: playlist
        title: Reubens Favourite Music (card)
      04-7B-6F-AA-ED-6C-80:
        media_content_id: PLbNmRtwuOMuijrqEgfJowKcaKiqeBATG2
        media_content_type: playlist
        title: Sebs Favourite Music (card)
      8A-CB-65-85:
        media_content_id: PLbNmRtwuOMuijrqEgfJowKcaKiqeBATG2
        media_content_type: playlist
        title: Sebs Favourite Music
- id: '1645116168862'
  alias: 'ZHA: Anna''s Desk Button'
  description: ''
  use_blueprint:
    path: SeanM/zha-aqara-wireless-mini-switch.yaml
    input:
      aqara_mini_switch: 0f3089187d04d66ad82ae402722e0942
      button_single_press:
      - service: light.toggle
        data: {}
        target:
          entity_id: light.annas_desk
      button_double_press:
      - service: light.turn_off
        entity_id: all
- id: '1646231230823'
  alias: Office Cube
  description: ''
  use_blueprint:
    path: EdwardTFN/aqara-cube-zha-simplified-face-based-device-control.yaml
    input:
      last_face_input: input_number.office_cube_current_face
      cube: 9f50d49473ecd72dad9e827acb4e6f60
      face_1_flip:
      - service: notify.mobile_app_toms_phone
        data:
          message: Side 1
      face_2_flip:
      - service: notify.mobile_app_toms_phone
        data:
          message: Side 2
      face_3_flip:
      - service: notify.mobile_app_toms_phone
        data:
          message: Side 3
      face_4_flip:
      - service: notify.mobile_app_toms_phone
        data:
          message: Side 4
      face_5_flip:
      - service: notify.mobile_app_toms_phone
        data:
          message: Side 5
      face_6_flip:
      - service: notify.mobile_app_toms_phone
        data:
          message: Side 6
      face_1_knock:
      - service: light.toggle
        data: {}
        target:
          entity_id: light.toms_desk_master
      face_1_rotate_counter_clockwise:
      - service: input_select.select_previous
        data: {}
        target:
          entity_id: input_select.wled_effects
      - service: light.turn_on
        entity_id: light.toms_desk_master
        data:
          effect: '{{states(''input_select.wled_effects'')}}'
      face_2_knock:
      - service: light.toggle
        data: {}
        target:
          entity_id:
          - light.second_bedroom_ceiling
      face_5_knock:
      - service: light.toggle
        data: {}
        target:
          entity_id: light.annas_desk
      face_5_rotate_counter_clockwise:
      - service: light.turn_on
        data:
          brightness_step_pct: -25
        target:
          entity_id: light.annas_desk
      face_5_rotate_clockwise:
      - service: light.turn_on
        data:
          brightness_step_pct: 25
        target:
          entity_id: light.annas_desk
      face_2_rotate_counter_clockwise:
      - service: light.turn_on
        data:
          brightness_step_pct: -25
        target:
          entity_id: light.second_bedroom_ceiling
      face_2_rotate_clockwise:
      - service: light.turn_on
        data:
          brightness_step_pct: 25
        target:
          entity_id: light.second_bedroom_ceiling
      face_1_rotate_clockwise:
      - service: input_select.select_previous
        data: {}
        target:
          entity_id: input_select.wled_effects
      - service: light.turn_on
        entity_id: light.toms_desk_master
        data:
          effect: '{{states(''input_select.wled_effects'')}}'
      face_4_knock:
      - service: light.toggle
        data: {}
        target:
          area_id: 4ff1e165afb84885be26f9e1add47e4f
      face_4_rotate_counter_clockwise:
      - service: light.turn_on
        data:
          brightness_step_pct: -26
        target:
          area_id: 4ff1e165afb84885be26f9e1add47e4f
      face_4_rotate_clockwise:
      - service: light.turn_on
        data:
          brightness_step_pct: 25
        target:
          area_id: 4ff1e165afb84885be26f9e1add47e4f
- id: '1648486249768'
  alias: 'NFC: Tag ''Office off'' is scanned'
  description: ''
  trigger:
  - platform: tag
    tag_id: 1b679f1c-77ce-4875-93d0-18d058e268e6
  condition: []
  action:
  - service: light.turn_off
    data: {}
    target:
      area_id: 4ff1e165afb84885be26f9e1add47e4f
  - service: switch.turn_off
    data: {}
    target:
      entity_id: switch.toms_desk
  mode: single
- id: '1649170956033'
  alias: ESPresense test- Tom
  description: ''
  trigger:
  - platform: state
    entity_id: sensor.toms_phone_ble
    for:
      hours: 0
      minutes: 0
      seconds: 0
  condition:
  - condition: template
    value_template: '{{trigger.from_state.state != trigger.to_state.state}}'
  action:
  - service: notify.mobile_app_toms_phone
    data:
      title: ESPresense
      message: Tom is now in the {{states('sensor.toms_phone_ble')}}
  mode: single
- id: '1650886318156'
  alias: Fade Seb's speaker at bedtime
  description: ''
  trigger:
  - platform: time
    at: '21:30:00'
  condition:
  - condition: state
    entity_id: media_player.seb_s_home
    state: playing
  action:
  - service: script.fade_volume
    data:
      target_player: media_player.seb_s_home
      duration: 300
      target_volume: 0
  - wait_for_trigger:
    - platform: state
      entity_id: media_player.seb_s_home
      attribute: volume_level
      to: '0'
    timeout:
      hours: 0
      minutes: 5
      seconds: 5
      milliseconds: 0
  - service: media_player.media_stop
    data:
      entity_id: media_player.seb_s_home
  - delay:
      hours: 0
      minutes: 0
      seconds: 5
      milliseconds: 0
  - service: media_player.media_stop
    data:
      entity_id: media_player.seb_s_home
  mode: single
- id: '1651247435420'
  alias: Fade Reu's speaker at bedtime
  description: ''
  trigger:
  - platform: time
    at: '21:30:00'
  condition:
  - condition: state
    entity_id: media_player.reuben_s_room_speaker
    state: playing
  action:
  - service: script.fade_volume
    data:
      target_player: media_player.reuben_s_room_speaker
      target_volume: 0
      duration: 300
  - wait_for_trigger:
    - platform: state
      entity_id: media_player.reuben_s_room_speaker
      attribute: volume_level
      to: '0'
    timeout:
      hours: 0
      minutes: 5
      seconds: 5
      milliseconds: 0
  - service: media_player.media_stop
    data:
      entity_id: media_player.reuben_s_room_speaker
  - delay:
      hours: 0
      minutes: 0
      seconds: 5
      milliseconds: 0
  - service: media_player.media_stop
    data:
      entity_id: media_player.reuben_s_room_speaker
  mode: single
- id: '1659533681253'
  alias: Open office blind in the morning
  description: ''
  trigger:
  - platform: time
    at: 08:00:00
  condition:
  - condition: numeric_state
    entity_id: number.office_blind_analog_output
    below: '100'
  action:
  - service: cover.open_cover
    data: {}
    target:
      entity_id: cover.office_blind
  mode: single
- id: '1661876070774'
  alias: Update all_my_lights group
  description: ''
  trigger:
  - platform: homeassistant
    event: start
  condition: []
  action:
  - service: group.set
    data:
      object_id: all_my_lights
      entities: '{{ states.light |  map(attribute=''entity_id'') | join('','') }}

        '
  mode: single
- id: '1664188667644'
  alias: 'Lightswitch: Main Bedroom Opple'
  description: ''
  use_blueprint:
    path: Jarne_Roussard/aqara-opple-4-buttons-for-zha.yaml
    input:
      remote: 4ea4829aee92ea2f29100c58eb2e75da
      button_top_left_single_press:
      - type: turn_off
        device_id: f5cda250d456ab9d753117c612f812c4
        entity_id: d8d3d88474f3161c637f50a46ea6671d
        domain: light
      button_top_left_double_press:
      - service: light.turn_off
        data: {}
        target:
          area_id: main_bedroom
      button_top_left_hold_in:
      - type: turn_on
        device_id: f5cda250d456ab9d753117c612f812c4
        entity_id: d8d3d88474f3161c637f50a46ea6671d
        domain: light
        brightness_pct: 30
      button_top_right_single_press:
      - type: turn_on
        device_id: f5cda250d456ab9d753117c612f812c4
        entity_id: d8d3d88474f3161c637f50a46ea6671d
        domain: light
        brightness_pct: 100
      button_top_right_double_press:
      - service: light.turn_on
        data:
          brightness_pct: 100
        target:
          area_id: main_bedroom
      button_top_right_hold_in:
      - type: turn_on
        device_id: f5cda250d456ab9d753117c612f812c4
        entity_id: d8d3d88474f3161c637f50a46ea6671d
        domain: light
        brightness_pct: 60
      button_bottom_left_single_press:
      - type: turn_off
        device_id: b9c88a37811e285dc2b594f847e29cf1
        entity_id: light.main_bedroom_bloom
        domain: light
      button_bottom_left_double_press:
      - service: light.turn_off
        data: {}
        target:
          area_id: main_bedroom
      button_bottom_left_hold_in:
      - type: turn_on
        device_id: b9c88a37811e285dc2b594f847e29cf1
        entity_id: light.main_bedroom_bloom
        domain: light
        brightness_pct: 30
      button_bottom_right_single_press:
      - type: turn_on
        device_id: b9c88a37811e285dc2b594f847e29cf1
        entity_id: light.main_bedroom_bloom
        domain: light
        brightness_pct: 100
      button_bottom_right_double_press:
      - service: light.turn_on
        data:
          brightness_pct: 100
        target:
          area_id: main_bedroom
      button_bottom_right_hold_in:
      - type: turn_on
        device_id: b9c88a37811e285dc2b594f847e29cf1
        entity_id: light.main_bedroom_bloom
        domain: light
        brightness_pct: 60
- id: '1664293977688'
  alias: 'Lightswitch: Office opple'
  description: ''
  use_blueprint:
    path: Jarne_Roussard/aqara-opple-4-buttons-for-zha.yaml
    input:
      remote: 445eb9cadaf00ed25eadaabdda187eb9
      button_top_left_single_press:
      - type: turn_off
        device_id: cffb061e300b83a901a07ad99b0abaa4
        entity_id: light.second_bedroom_ceiling
        domain: light
      button_top_left_double_press:
      - type: turn_off
        device_id: a4b059569334cd311559fcb877f3deba
        entity_id: light.toms_desk_master
        domain: light
      - type: turn_off
        device_id: 63e528584034c3704aa0ea7b8d0c6adb
        entity_id: switch.toms_monitor_light
        domain: switch
      - type: turn_off
        device_id: b4b84b4ae3fab4400b0e133c18da5980
        entity_id: light.annas_desk
        domain: light
      - type: turn_off
        device_id: cffb061e300b83a901a07ad99b0abaa4
        entity_id: light.second_bedroom_ceiling
        domain: light
      button_top_left_hold_in:
      - service: light.turn_on
        data:
          brightness_pct: 29
        target:
          device_id: cffb061e300b83a901a07ad99b0abaa4
      button_top_right_single_press:
      - type: turn_on
        device_id: cffb061e300b83a901a07ad99b0abaa4
        entity_id: light.second_bedroom_ceiling
        domain: light
        brightness_pct: 100
      button_top_right_double_press:
      - type: turn_on
        device_id: 63e528584034c3704aa0ea7b8d0c6adb
        entity_id: switch.toms_monitor_light
        domain: switch
      - type: turn_on
        device_id: a4b059569334cd311559fcb877f3deba
        entity_id: light.toms_desk_master
        domain: light
        brightness_pct: 100
      - type: turn_on
        device_id: cffb061e300b83a901a07ad99b0abaa4
        entity_id: light.second_bedroom_ceiling
        domain: light
        brightness_pct: 100
      - type: turn_on
        device_id: b4b84b4ae3fab4400b0e133c18da5980
        entity_id: light.annas_desk
        domain: light
        brightness_pct: 100
      button_top_right_hold_release: []
      button_top_right_hold_in:
      - service: light.turn_on
        data:
          brightness_pct: 60
        target:
          device_id: cffb061e300b83a901a07ad99b0abaa4
      button_bottom_left_single_press:
      - type: turn_off
        device_id: b4b84b4ae3fab4400b0e133c18da5980
        entity_id: light.annas_desk
        domain: light
      - type: turn_off
        device_id: 63e528584034c3704aa0ea7b8d0c6adb
        entity_id: switch.toms_monitor_light
        domain: switch
      - type: turn_off
        device_id: a4b059569334cd311559fcb877f3deba
        entity_id: light.toms_desk_master
        domain: light
      button_bottom_left_double_press:
      - type: turn_off
        device_id: 63e528584034c3704aa0ea7b8d0c6adb
        entity_id: switch.toms_monitor_light
        domain: switch
      - type: turn_off
        device_id: a4b059569334cd311559fcb877f3deba
        entity_id: light.toms_desk_master
        domain: light
      - type: turn_off
        device_id: b4b84b4ae3fab4400b0e133c18da5980
        entity_id: light.annas_desk
        domain: light
      - type: turn_off
        device_id: cffb061e300b83a901a07ad99b0abaa4
        entity_id: light.second_bedroom_ceiling
        domain: light
      button_bottom_left_hold_in:
      - service: light.turn_on
        data:
          brightness_pct: 30
        target:
          device_id:
          - b4b84b4ae3fab4400b0e133c18da5980
          - 63e528584034c3704aa0ea7b8d0c6adb
      button_bottom_right_single_press:
      - type: turn_on
        device_id: b4b84b4ae3fab4400b0e133c18da5980
        entity_id: light.annas_desk
        domain: light
        brightness_pct: 100
      - type: turn_on
        device_id: 63e528584034c3704aa0ea7b8d0c6adb
        entity_id: switch.toms_monitor_light
        domain: switch
      - type: turn_on
        device_id: a4b059569334cd311559fcb877f3deba
        entity_id: light.toms_desk_master
        domain: light
        brightness_pct: 100
      button_bottom_right_double_press:
      - type: turn_on
        device_id: b4b84b4ae3fab4400b0e133c18da5980
        entity_id: light.annas_desk
        domain: light
        brightness_pct: 100
      - type: turn_on
        device_id: a4b059569334cd311559fcb877f3deba
        entity_id: light.toms_desk_master
        domain: light
        brightness_pct: 100
      - type: turn_on
        device_id: cffb061e300b83a901a07ad99b0abaa4
        entity_id: light.second_bedroom_ceiling
        domain: light
      - type: turn_on
        device_id: 63e528584034c3704aa0ea7b8d0c6adb
        entity_id: switch.toms_monitor_light
        domain: switch
      button_bottom_right_hold_in:
      - service: light.turn_on
        data:
          brightness_step: 60
        target:
          device_id:
          - b4b84b4ae3fab4400b0e133c18da5980
          - 63e528584034c3704aa0ea7b8d0c6adb
- id: '1665133208840'
  alias: Close office blind when bright
  description: ''
  trigger:
  - platform: numeric_state
    entity_id: sensor.cactus_illuminance
    for:
      hours: 0
      minutes: 1
      seconds: 0
    above: input_number.office_window_brightness_threshold
  condition:
  - condition: state
    entity_id: binary_sensor.workday_sensor
    state: 'on'
  - condition: state
    entity_id: input_boolean.holiday_mode
    state: 'off'
  - condition: numeric_state
    entity_id: sun.sun
    attribute: azimuth
    above: 90
    below: 150
  action:
  - service: cover.set_cover_position
    data:
      position: '{{ states(''input_number.office_window_blind_shade_percent'') }}'
    target:
      device_id: d900db50135294c1549bb9a9ecde74b0
  mode: single
- id: '1665133518037'
  alias: Open office blind when not bright
  description: ''
  trigger:
  - platform: numeric_state
    entity_id: sensor.cactus_illuminance
    for:
      hours: 0
      minutes: 5
      seconds: 0
    below: input_number.office_window_brightness_threshold
  - platform: numeric_state
    entity_id: sun.sun
    attribute: azimuth
    above: 150
  - platform: numeric_state
    entity_id: sun.sun
    below: 90
    attribute: azimuth
  condition:
  - condition: numeric_state
    entity_id: sun.sun
    attribute: elevation
    above: -1
  action:
  - service: cover.open_cover
    data: {}
    target:
      device_id: d900db50135294c1549bb9a9ecde74b0
  mode: single
- id: '1675701493281'
  alias: 'Matrix: Set text'
  description: ''
  trigger:
  - platform: state
    entity_id:
    - input_text.matrix_text
  condition: []
  action:
  - service: rest_command.matrix_text
    data:
      text: '{{states(''input_text.matrix_text'')[:28]}}'
      segment: 1
  mode: single
- id: '1675852669630'
  alias: Matrix - Default
  description: Return to default display in various trigger conditions
  trigger:
  - platform: state
    entity_id:
    - binary_sensor.zoom_tombjss
    from: 'on'
    to: 'off'
  - platform: state
    entity_id:
    - input_text.matrix_text
    for:
      hours: 0
      minutes: 1
      seconds: 0
  condition: []
  action:
  - service: rest_command.matrix_image
    data:
      segment: 0
      image: 0,1,'000000',1,7,'3f67af',7,8,'000000',8,9,'3f67af',9,11,'000000',11,12,'950408',12,15,'000000',15,16,'3f67af',16,17,'365b9f',17,18,'000001',18,19,'370000',19,20,'990000',20,21,'350000',21,22,'000000',22,23,'000102',23,24,'365b9d',24,25,'365b9f',25,26,'000001',26,27,'2c0000',27,28,'850000',28,29,'4b0000',29,30,'0b0000',30,31,'000102',31,32,'375c9f',32,33,'365b9f',33,34,'000001',34,35,'0c0000',35,36,'470000',36,37,'770000',37,38,'3c0000',38,39,'070103',39,40,'375c9f',40,41,'365b9f',41,42,'000001',42,43,'000000',43,44,'0d0000',44,45,'440000',45,46,'9b0000',46,47,'290103',47,48,'375c9f',48,49,'365b9f',49,50,'000001',50,52,'000000',52,53,'070000',53,54,'240000',54,55,'0b0103',55,56,'375c9f',56,57,'0f192c',57,58,'3c65af',58,61,'3c67b2',61,62,'3d67b2',62,63,'3b64ae',63,64,'0f1a2d'
  - service: rest_command.matrix_text
    data:
      segment: 1
      text: ''
  mode: single
- id: '1675874795995'
  alias: 'Matrix: Music artist'
  description: ''
  trigger:
  - platform: state
    entity_id:
    - media_player.office_wifi
    id: Google Speaker
  - platform: state
    entity_id:
    - sensor.tdroza
    id: LastFM
  condition: []
  action:
  - choose:
    - conditions:
      - condition: trigger
        id: Google Speaker
      sequence:
      - service: input_text.set_value
        data:
          entity_id: input_text.matrix_text
          value: '{{state_attr(''media_player.office_wifi'', ''media_artist'')}}:
            {{state_attr(''media_player.office_wifi'', ''media_title'') | truncate(28,
            true) }}

            '
    - conditions:
      - condition: trigger
        id: LastFM
      sequence:
      - service: input_text.set_value
        data:
          entity_id: input_text.matrix_text
          value: '{{states(''sensor.tdroza'') | replace('' - '', '': '') | truncate(28,
            true) }}

            '
  - service: rest_command.matrix_effect
    data:
      segment: 0
      effect: 139
  mode: single
- id: '1678450635245'
  alias: Notify when Kodi Media Centre is left on
  description: ''
  trigger:
  - platform: device
    type: turned_on
    device_id: 5bb82585d208d7e31acd3eb432345e59
    entity_id: switch.media_centre
    domain: switch
    for:
      hours: 3
      minutes: 0
      seconds: 0
  condition: []
  action:
  - service: notify.mobile_app_toms_phone
    data:
      message: The Kodi Media Centre has been left on for 3 hours
      title: Media Centre
      data:
        actions:
        - action: KODI_OFF
          title: Turn off
  mode: single
- id: '1678450844041'
  alias: Handle KODI_OFF action
  description: ''
  trigger:
  - platform: event
    event_type: mobile_app_notification_action
    event_data:
      action: KODI_OFF
  condition: []
  action:
  - type: turn_off
    device_id: 5bb82585d208d7e31acd3eb432345e59
    entity_id: switch.media_centre
    domain: switch
  mode: single
- id: '1680508943961'
  alias: 'Solar: Update forecast'
  description: ''
  trigger:
  - platform: time
    at: 03:58:12
  - platform: time
    at: '12:02:08'
  - platform: time
    at: '17:04:14'
  condition: []
  action:
  - service: solcast_solar.update_forecasts
    data: {}
  mode: single
- id: '1681728985474'
  alias: 'Airer: Turn off'
  description: Turn off heated airer after planned runtime, or insufficient excess
    solar
  trigger:
  - platform: numeric_state
    entity_id: sensor.airer_run_time
    above: input_number.airer_target_runtime
    id: run_time_exceeded
  - platform: state
    entity_id:
    - input_boolean.heated_airer
    from: 'on'
    to: 'off'
    id: manually_disable
  - platform: template
    value_template: '{{ states(''sensor.solar_excess'') | int < 10 and is_state(''input_boolean.heated_airer_solar_override'',
      ''off'') }}'
    for:
      hours: 0
      minutes: 3
      seconds: 0
    id: insufficient_solar
  condition:
  - condition: state
    entity_id: switch.heated_airer
    state: 'on'
  action:
  - type: turn_off
    device_id: b050da49473a618fe5a54f6fcd6737b2
    entity_id: switch.heated_airer
    domain: switch
  - condition: trigger
    id: run_time_exceeded
  - service: input_boolean.turn_off
    data: {}
    target:
      entity_id: input_boolean.heated_airer
  mode: single
- id: '1681730931444'
  alias: 'Airer: Turn On'
  description: ''
  trigger:
  - platform: template
    value_template: '{{ states(''input_boolean.heated_airer'') == "on" and states(''sensor.solar_excess'')
      | int > 350 }}'
  condition: []
  action:
  - type: turn_on
    device_id: b050da49473a618fe5a54f6fcd6737b2
    entity_id: switch.heated_airer
    domain: switch
  mode: single
- id: '1683233886118'
  alias: 'Solar Lamp: Cache options'
  description: ''
  trigger:
  - platform: state
    entity_id:
    - sensor.solax_local
  condition:
  - condition: numeric_state
    entity_id: sensor.solax_local_load_power
    above: 0
  action:
  - if:
    - condition: numeric_state
      entity_id: sensor.solax_local_pv_output
      above: sensor.solax_local_grid_power_import
    - condition: and
      conditions:
      - condition: numeric_state
        entity_id: sensor.solax_local_pv_output
        above: sensor.solax_local_battery_power_out
    then:
    - service: input_select.select_option
      data:
        option: '{{state_attr(''input_select.solarlamp_palette'', ''options'')[0]
          }}'
      target:
        entity_id: input_select.solarlamp_palette
    else:
    - if:
      - condition: numeric_state
        entity_id: sensor.solax_local_battery_power_out
        above: sensor.solax_local_grid_power_import
      - condition: numeric_state
        entity_id: sensor.solax_local_battery_power_out
        above: sensor.solax_local_pv_output
      then:
      - service: input_select.select_option
        data:
          option: '{{state_attr(''input_select.solarlamp_palette'', ''options'')[1]
            }}'
        target:
          entity_id: input_select.solarlamp_palette
      else:
      - service: input_select.select_option
        data:
          option: '{{state_attr(''input_select.solarlamp_palette'', ''options'')[2]
            }}'
        target:
          entity_id: input_select.solarlamp_palette
  mode: single
- id: '1683234400143'
  alias: 'Solar Lamp: Update lamp'
  description: ''
  trigger:
  - platform: state
    entity_id:
    - input_select.solarlamp_palette
  - platform: device
    type: turned_on
    device_id: ec63665887421c732ef2e422c5514eac
    entity_id: light.solar_lamp
    domain: light
  condition:
  - condition: state
    entity_id: light.solar_lamp
    state: 'on'
  action:
  - service: select.select_option
    data:
      option: SolarState
    target:
      entity_id: select.solar_lamp_preset
  - service: select.select_option
    data:
      option: '{{ states(''input_select.solarlamp_palette'') }}'
    target:
      entity_id: select.solar_lamp_color_palette
  mode: single
- id: '1683805329919'
  alias: Living room Idle alert
  description: Alert if no motion in living room but lights or tv are on
  trigger:
  - type: not_occupied
    platform: device
    device_id: fc79fe98834fa565da4e2af11ad62e91
    entity_id: binary_sensor.lumi_lumi_sensor_motion_aq2_occupancy
    domain: binary_sensor
  condition:
  - condition: or
    conditions:
    - condition: state
      entity_id: light.living_room_light_group
      state: 'on'
    - condition: state
      entity_id: media_player.living_room_tv
      state: playing
    - condition: state
      entity_id: media_player.halo
      state: playing
  action:
  - service: notify.mobile_app_toms_phone
    data:
      message: No motion in Living Room, but lights or TV are on
      title: Idle alert
  mode: single
- id: '1687424997925'
  alias: Open main bedroom blinds in the morning
  description: Opens the blinds at 07:30 on weekends and gradually from 06:00 on weekdays
  trigger:
  - platform: time
    at: 07:30:00
    id: weekend
  - platform: time
    at: 06:00:00
    id: weekday
  condition:
  - condition: or
    conditions:
    - alias: it's a weekday
      condition: and
      conditions:
      - condition: trigger
        id:
        - weekday
      - condition: time
        weekday:
        - mon
        - tue
        - wed
        - thu
        - fri
    - alias: it's the weekend
      condition: and
      conditions:
      - condition: trigger
        id:
        - weekend
      - condition: time
        weekday:
        - sat
        - sun
  action:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - weekend
      sequence:
      - service: cover.open_cover
        data: {}
        target:
          area_id: main_bedroom
    - conditions:
      - condition: trigger
        id:
        - weekday
      sequence:
      - service: cover.set_cover_position
        data:
          position: 25
        target:
          area_id: main_bedroom
      - delay:
          hours: 0
          minutes: 10
          seconds: 0
          milliseconds: 0
      - service: cover.set_cover_position
        data:
          position: 50
        target:
          area_id: main_bedroom
      - delay:
          hours: 0
          minutes: 10
          seconds: 0
          milliseconds: 0
      - service: cover.set_cover_position
        data:
          position: 75
        target:
          area_id: main_bedroom
      - delay:
          hours: 0
          minutes: 10
          seconds: 0
          milliseconds: 0
      - service: cover.set_cover_position
        data:
          position: 100
        target:
          area_id: main_bedroom
  mode: single
- id: '1688978901597'
  alias: 'Lightswitch: Seb''s Opple'
  description: ''
  use_blueprint:
    path: Jarne_Roussard/aqara-opple-4-buttons-for-zha.yaml
    input:
      remote: 66d322a356e1c6872bc9d49d43dd9a8e
      button_top_left_single_press:
      - type: turn_off
        device_id: d06086fc62c3d9eb55cc76e0ae5de10a
        entity_id: 8cbf964adee97b7aa253dbe942e02997
        domain: light
      button_top_left_double_press:
      - service: light.turn_off
        metadata: {}
        data: {}
        target:
          entity_id:
          - light.sebs_ceiling
          - light.sebs_lamp
          - light.sebs_floorlamp
      button_top_left_hold_in:
      - service: light.turn_on
        data:
          brightness_pct: 30
        target:
          device_id:
          - d06086fc62c3d9eb55cc76e0ae5de10a
      button_top_right_single_press:
      - type: turn_on
        device_id: d06086fc62c3d9eb55cc76e0ae5de10a
        entity_id: 8cbf964adee97b7aa253dbe942e02997
        domain: light
        brightness_pct: 100
      button_top_right_double_press:
      - service: light.turn_on
        metadata: {}
        data:
          brightness_pct: 75
        target:
          entity_id:
          - light.sebs_ceiling
          - light.sebs_lamp
          - light.sebs_floorlamp
      button_top_right_hold_release: []
      button_top_right_hold_in:
      - type: turn_on
        device_id: d06086fc62c3d9eb55cc76e0ae5de10a
        entity_id: 8cbf964adee97b7aa253dbe942e02997
        domain: light
        brightness_pct: 70
      button_bottom_left_single_press:
      - type: turn_off
        device_id: 4fcff377266e9e7d5f9b7098401120b6
        entity_id: 0f90b36a06ba8e8df751b30d18eac37c
        domain: light
      - type: turn_off
        device_id: 7bbe5608917bc2dbac2783f3e8b14d44
        entity_id: 11b037cbafc13a4e0d80af31407060b3
        domain: light
      button_bottom_left_double_press:
      - service: light.turn_off
        metadata: {}
        data: {}
        target:
          entity_id:
          - light.sebs_ceiling
          - light.sebs_lamp
          - light.sebs_floorlamp
      button_bottom_left_hold_in:
      - service: media_player.volume_down
        data: {}
        target:
          entity_id: media_player.seb_s_home
      button_bottom_right_single_press:
      - type: turn_on
        device_id: 4fcff377266e9e7d5f9b7098401120b6
        entity_id: 0f90b36a06ba8e8df751b30d18eac37c
        domain: light
      - type: turn_on
        device_id: 7bbe5608917bc2dbac2783f3e8b14d44
        entity_id: 11b037cbafc13a4e0d80af31407060b3
        domain: light
      button_bottom_right_double_press:
      - service: light.turn_on
        metadata: {}
        data:
          brightness_pct: 75
        target:
          entity_id:
          - light.sebs_ceiling
          - light.sebs_lamp
          - light.sebs_floorlamp
      button_bottom_right_hold_in: []
      button_bottom_right_triple_press: []
      button_bottom_right_hold_release:
- id: '1688981578290'
  alias: 'Lightswitch: Reu''s Room Opple'
  description: ''
  use_blueprint:
    path: Jarne_Roussard/aqara-opple-4-buttons-for-zha.yaml
    input:
      remote: 83df1f62053159716b814cfd72b827df
      button_top_left_single_press:
      - type: turn_off
        device_id: 61f89eb89fac9724606bb7e0ffc52c9b
        entity_id: c3b9816ec82bfeb67dcd86d19b0adac7
        domain: light
      button_top_left_double_press:
      - type: turn_off
        device_id: 61f89eb89fac9724606bb7e0ffc52c9b
        entity_id: c3b9816ec82bfeb67dcd86d19b0adac7
        domain: light
      - type: turn_off
        device_id: e04b748fc61f7ca1d9a4a202ddcefe7a
        entity_id: f035cd56447801b7312fbce5f9453fa1
        domain: light
      button_top_left_hold_in:
      - service: light.turn_on
        data:
          brightness_pct: 30
        target:
          device_id:
          - d06086fc62c3d9eb55cc76e0ae5de10a
      - type: turn_on
        device_id: 61f89eb89fac9724606bb7e0ffc52c9b
        entity_id: c3b9816ec82bfeb67dcd86d19b0adac7
        domain: light
        brightness_pct: 30
      button_top_right_single_press:
      - type: turn_on
        device_id: 61f89eb89fac9724606bb7e0ffc52c9b
        entity_id: c3b9816ec82bfeb67dcd86d19b0adac7
        domain: light
      button_top_right_double_press:
      - type: turn_on
        device_id: 61f89eb89fac9724606bb7e0ffc52c9b
        entity_id: c3b9816ec82bfeb67dcd86d19b0adac7
        domain: light
        brightness_pct: 100
      - type: turn_on
        device_id: e04b748fc61f7ca1d9a4a202ddcefe7a
        entity_id: f035cd56447801b7312fbce5f9453fa1
        domain: light
      button_top_right_hold_release: []
      button_top_right_hold_in:
      - type: turn_on
        device_id: 61f89eb89fac9724606bb7e0ffc52c9b
        entity_id: c3b9816ec82bfeb67dcd86d19b0adac7
        domain: light
        brightness_pct: 70
      button_bottom_left_single_press:
      - type: turn_off
        device_id: e04b748fc61f7ca1d9a4a202ddcefe7a
        entity_id: f035cd56447801b7312fbce5f9453fa1
        domain: light
      button_bottom_left_double_press:
      - type: turn_off
        device_id: 61f89eb89fac9724606bb7e0ffc52c9b
        entity_id: c3b9816ec82bfeb67dcd86d19b0adac7
        domain: light
      - type: turn_off
        device_id: e04b748fc61f7ca1d9a4a202ddcefe7a
        entity_id: f035cd56447801b7312fbce5f9453fa1
        domain: light
      button_bottom_left_hold_in:
      - service: media_player.volume_down
        data: {}
        target:
          entity_id: media_player.reuben_s_room_speaker
      button_bottom_right_single_press:
      - type: turn_on
        device_id: e04b748fc61f7ca1d9a4a202ddcefe7a
        entity_id: f035cd56447801b7312fbce5f9453fa1
        domain: light
      button_bottom_right_double_press:
      - type: turn_on
        device_id: 61f89eb89fac9724606bb7e0ffc52c9b
        entity_id: c3b9816ec82bfeb67dcd86d19b0adac7
        domain: light
        brightness_pct: 100
      - type: turn_on
        device_id: e04b748fc61f7ca1d9a4a202ddcefe7a
        entity_id: f035cd56447801b7312fbce5f9453fa1
        domain: light
      button_bottom_right_hold_in:
      - service: media_player.volume_up
        data: {}
        target:
          entity_id: media_player.reuben_s_room_speaker
      button_bottom_right_triple_press:
      - service: light.turn_on
        target:
          entity_id: light.rname
        data:
          effect: '{{ state_attr(''light.rname'', ''effect_list'') | random }}'
      button_top_right_triple_press: []
- id: '1693819219757'
  alias: 'Solax: Reset grid charge at 7am'
  description: Reset grid charge params every morning, after possible overnight charging
    completed
  trigger:
  - platform: time
    at: 06:59:45
  condition: []
  action:
  - repeat:
      sequence:
      - service: rest_command.solax_local_charge_battery_from_grid
        data:
          level: 100
      - delay:
          seconds: 10
      - service: rest_command.solax_local_set_forced_charge_start
        data:
          value: '{{0 + 0 * 256}}

            '
        enabled: false
      - delay:
          seconds: 10
        enabled: false
      - service: homeassistant.update_entity
        data: {}
        target:
          entity_id: sensor.solax_rest_local_settings
      until:
      - condition: template
        value_template: '{{ (states(''sensor.solax_local_battery_charge_from_grid_to'')|int==100)
          or repeat.index == 3 }}      '
  mode: single
- id: '1693819732477'
  alias: 'Solax: Force grid charge'
  description: Every morning during flux import period, charge battery if solar forecast
    for the day is low
  trigger:
  - platform: time
    at: 04:00:00
  condition:
  - condition: numeric_state
    entity_id: sensor.solcast_pv_forecast_forecast_today
    below: input_number.average_daily_kwh_consumed
  - condition: state
    entity_id: input_boolean.holiday_mode
    state: 'off'
  - condition: numeric_state
    entity_id: sensor.solax_local_battery_soc
    below: 45
    enabled: false
  action:
  - service: input_number.set_value
    data:
      value: "{% set forecast_kwh = states('sensor.solcast_pv_forecast_forecast_today')|float
        %}  {% set battery_usable_kwh = 5.8*0.9 %} {% set charge_from_grid_kwh = (states('input_number.average_daily_kwh_consumed')|int
        - forecast_kwh) %}  {% set charge_from_grid_pc = 10 + 100*charge_from_grid_kwh/battery_usable_kwh%}
        {{max(0,min(charge_from_grid_pc|int,100))}}    \n"
    target:
      entity_id: input_number.solax_battery_soc_target
  - repeat:
      sequence:
      - service: rest_command.solax_local_charge_battery_from_grid
        data:
          level: '{{states(''input_number.solax_battery_soc_target'') | int}}

            '
      - delay:
          seconds: 10
        enabled: false
      - service: rest_command.solax_local_set_forced_charge_start
        data:
          value: '{{3 + 5 * 256}}

            '
        enabled: false
      - service: notify.mobile_app_toms_phone
        data:
          message: 'Home battery set to charge from grid. Target: {{states(''input_number.solax_battery_soc_target'')}}%
            Solar Forecast: {{states(''sensor.solcast_pv_forecast_forecast_today'')|
            round(2)}}kWh Attempt: {{repeat.index}}'
          title: "\U0001F324 Solar "
      - delay:
          seconds: 10
      - service: homeassistant.update_entity
        data: {}
        target:
          entity_id: sensor.solax_rest_local_settings
      - delay:
          seconds: 10
      until:
      - condition: template
        value_template: '{{ (states(''sensor.solax_local_battery_charge_from_grid_to'')|int==states(''input_number.solax_battery_soc_target'')|int)
          or repeat.index == 3 }}      '
  mode: single
- id: '1696098127864'
  alias: Dino
  description: ''
  trigger:
  - type: motion
    platform: device
    device_id: e8cd43fe0f2842bca71d1ee8b5adc5da
    entity_id: e7a3e2db6292b0b24b47623cb2d5cb60
    domain: binary_sensor
  condition:
  - condition: time
    after: 07:30:00
    before: '19:30:00'
  - condition: state
    entity_id: light.rname
    state: 'on'
  action:
  - variables:
      dinos:
      - https://tdroza.duckdns.org/local/dinosaur/dino.mp3
      - https://tdroza.duckdns.org/local/dinosaur/dino2.wav
      - https://tdroza.duckdns.org/local/dinosaur/dino3.wav
      - https://tdroza.duckdns.org/local/dinosaur/dino4.mp3
  - service: media_player.play_media
    data:
      media_content_type: music
      media_content_id: '{{dinos[range(0,2)|random|int]}}'
    target:
      entity_id: media_player.reuben_s_room_speaker
  mode: single
- id: '1697812591018'
  alias: Album A Day
  description: ''
  trigger:
  - platform: time
    at: 08:00:00
  condition: []
  action:
  - service: notify.mobile_app_toms_phone
    data:
      title: Album A Day
      message: <em>{{state_attr('sensor.album_a_day','name')}}</em> {{state_attr('sensor.album_a_day','artist')}}
        ({{state_attr('sensor.album_a_day','releaseDate')}})
      data:
        actions:
        - action: URI
          title: Play
          uri: https://music.youtube.com/playlist?list={{state_attr('sensor.album_a_day','youtubeMusicId')}}
        image: '{{state_attr(''sensor.album_a_day'',''images'')[1].url}}'
  mode: single
- id: '1700481098796'
  alias: OEPL Family Calendar
  description: ''
  trigger:
  - platform: time_pattern
    hours: /1
  - platform: state
    entity_id:
    - sensor.family_events
  condition:
  - condition: time
    after: 07:00:00
    before: '23:00:00'
  action:
  - data:
      dry-run: false
      background: white
      rotate: '{{180 if now().day < 15 else 0}}'
      payload:
      - type: rectangle
        x_start: 0
        y_start: 0
        x_end: 296
        y_end: 128
        fill: black
        outline: black
        width: 1
      - type: rectangle
        x_start: 0
        y_start: 33
        x_end: 296
        y_end: 64
        fill: red
        outline: red
        width: 1
      - type: rectangle
        x_start: 0
        y_start: 97
        x_end: 296
        y_end: 128
        fill: red
        outline: red
        width: 1
      - type: text
        x: 0
        y: 1
        size: 20
        color: white
        value: '{{state_attr(''sensor.family_events'', ''events'')[0].summary | truncate(28,
          true)}}'
      - type: text
        x: 295
        y: 31
        size: 12
        color: white
        anchor: rb
        value: '{% set startTimestamp = as_timestamp(state_attr(''sensor.family_events'',
          ''events'')[0].start)%} {% set endTimestamp = as_timestamp(state_attr(''sensor.family_events'',
          ''events'')[0].end)%} {% set time = ''All day'' if endTimestamp - startTimestamp
          == 86400 else startTimestamp | timestamp_custom(''%H:%M'') %} {{startTimestamp
          | timestamp_custom(''%a, '')}}{{time}}'
      - type: line
        x_start: 0
        x_end: 295
        y_start: 32
        y_end: 32
        fill: white
        width: 1
      - type: text
        x: 0
        y: 34
        size: 20
        color: white
        value: "{% if (state_attr('sensor.family_events', 'events') | length)  > 1
          %}\n  {{state_attr('sensor.family_events', 'events')[1].summary}}\n{% else
          %}\n  -\n{% endif %}"
      - type: text
        x: 295
        y: 63
        size: 12
        color: white
        anchor: rb
        value: "{% if (state_attr('sensor.family_events', 'events') | length)  > 1
          %}  {%   set startTimestamp = as_timestamp(state_attr('sensor.family_events',
          'events')[1].start)%}  {%   set endTimestamp = as_timestamp(state_attr('sensor.family_events',
          'events')[1].end)%}  {%  set time = 'All day' if endTimestamp - startTimestamp
          == 86400 else startTimestamp | timestamp_custom('%H:%M') %} \n   {{startTimestamp
          | timestamp_custom('%a, ')}}{{time}}\n{% endif %}"
      - type: line
        x_start: 0
        x_end: 295
        y_start: 64
        y_end: 64
        fill: white
        width: 1
      - type: text
        x: 0
        y: 66
        size: 20
        color: white
        value: "{% if (state_attr('sensor.family_events', 'events') | length)  > 2
          %}\n  {{state_attr('sensor.family_events', 'events')[2].summary}}\n{% else
          %}\n  -\n{% endif %}        "
      - type: text
        x: 295
        y: 95
        size: 12
        color: white
        anchor: rb
        value: "{% if (state_attr('sensor.family_events', 'events') | length)  > 2
          %}  {%   set startTimestamp = as_timestamp(state_attr('sensor.family_events',
          'events')[2].start)%}  {%   set endTimestamp = as_timestamp(state_attr('sensor.family_events',
          'events')[2].end)%} {%\n     set time = 'All day' if endTimestamp - startTimestamp
          == 86400 else\nstartTimestamp | timestamp_custom('%H:%M') %} \n     {{startTimestamp
          | timestamp_custom('%a, ')}}{{time}}\n{% endif %}"
      - type: line
        x_start: 0
        x_end: 295
        y_start: 96
        y_end: 96
        fill: white
        width: 1
      - type: text
        x: 0
        y: 98
        size: 20
        color: white
        value: "{% if (state_attr('sensor.family_events', 'events') | length)  > 3
          %} {{   state_attr('sensor.family_events', 'events')[3].summary}}  {% else
          %}\n  -\n{% endif %}"
      - type: text
        x: 295
        y: 127
        size: 12
        color: white
        anchor: rb
        value: "{% if (state_attr('sensor.family_events', 'events') | length)  > 3
          %}  {%   set startTimestamp = as_timestamp(state_attr('sensor.family_events',
          'events')[3].start)%}  {%   set endTimestamp = as_timestamp(state_attr('sensor.family_events',
          'events')[3].end) %}   {%   set time = 'All day' if endTimestamp - startTimestamp
          == 86400 else startTimestamp | timestamp_custom('%H:%M') %} \n   {{startTimestamp
          | timestamp_custom('%a, ')}}{{time}} \n{% endif %}"
    target:
      entity_id: open_epaper_link.00000218cf5d3b19
    action: open_epaper_link.drawcustom
  mode: restart
- id: '1700574169666'
  alias: OEPL Energy Dashboard
  description: ''
  trigger:
  - platform: time_pattern
    minutes: /10
  condition:
  - condition: time
    after: 08:00:00
    before: '18:00:00'
  action:
  - service: open_epaper_link.drawcustom
    data:
      dry-run: false
      background: white
      rotate: '{{270 if now().hour < 12 else 90 }}'
      payload:
      - type: rectangle
        x_start: 0
        x_end: 128
        y_start: 0
        y_end: 54
        fill: black
        outline: white
        width: 1
      - type: icon
        x: 3
        y: 3
        size: 50
        color: red
        value: solar-power
      - type: text
        x: 55
        anchor: lm
        y: 27
        size: 24
        color: red
        value: '{{states(''sensor.solax_local_pv_output'')|float/1000}}'
      - type: text
        x: 55
        anchor: lb
        y: 48
        size: 12
        color: red
        value: kW
      - type: rectangle
        x_start: 0
        x_end: 138
        y_start: 56
        y_end: 109
        fill: red
        outline: white
        width: 1
      - type: icon
        x: 3
        y: 58
        size: 50
        color: black
        value: '{{''transmission-tower'' if states(''sensor.solax_local_grid_power'')|float
          == 0 else ''transmission-tower-export'' if states(''sensor.solax_local_grid_power_import'')
          > states(''sensor.solax_local_grid_power_export'') else ''transmission-tower-import''}}'
      - type: text
        x: 55
        y: 82
        anchor: lm
        size: 24
        color: black
        value: '{{states(''sensor.solax_local_grid_power'')|float|abs/1000}}'
      - type: text
        x: 55
        anchor: lb
        y: 103
        size: 12
        color: black
        value: kW
      - type: rectangle
        x_start: 0
        x_end: 128
        y_start: 111
        y_end: 164
        fill: black
        outline: white
        width: 1
      - type: icon
        x: 3
        y: 113
        size: 50
        color: red
        value: home-outline
      - type: text
        x: 55
        y: 137
        anchor: lm
        size: 24
        color: red
        value: '{{states(''sensor.solax_local_load_power'')|int}}'
      - type: icon
        x: 55
        y: 147
        size: 15
        color: '{{''red'' if is_state(''binary_sensor.washer'',''on'') else ''white''}}'
        value: '{{''washing-machine'' if is_state(''binary_sensor.washer'',''on'')
          else ''washing-machine-off''}}'
      - type: icon
        x: 75
        y: 147
        size: 15
        color: '{{''red'' if is_state_attr(''climate.hive_thermostat'',''hvac_action'',''heating'')
          else ''white''}}'
        value: '{{''fire'' if is_state_attr(''climate.hive_thermostat'',''hvac_action'',''heating'')
          else ''fire-off''}}'
      - type: rectangle
        x_start: 0
        x_end: 128
        y_start: 166
        y_end: 219
        fill: red
        outline: white
        width: 1
      - type: icon
        x: 3
        y: 168
        size: 50
        color: black
        value: battery-{{(states('sensor.solax_local_battery_soc') | int / 10) | round(0)
          * 10}}
      - type: icon
        x: 55
        y: 185
        size: 15
        color: black
        value: '{{''battery-plus'' if states(''sensor.solax_local_battery_power'')
          | int > 0 else ''battery-minus''}}'
      - type: text
        x: 72
        y: 200
        anchor: lb
        size: 15
        color: black
        value: '{{states(''sensor.solax_local_battery_power'') | int | abs}}W'
      - type: rectangle
        fill: red
        outline: white
        width: 1
        x_start: 55
        x_end: 126
        y_start: 173
        y_end: 183
      - type: rectangle
        fill: black
        outline: black
        width: 1
        x_start: 56
        x_end: '{{56+(71/100)*states(''sensor.solax_local_battery_soc'')|round}}'
        y_start: 174
        y_end: 182
      - type: text
        x: 125
        y: 175
        anchor: rt
        size: 9
        color: white
        value: '{{states(''sensor.solax_local_battery_soc'')}}%'
      - type: rectangle
        x_start: 0
        x_end: 128
        y_start: 221
        y_end: 274
        fill: black
        outline: white
        width: 1
      - type: icon
        x: 3
        y: 223
        size: 50
        color: red
        value: water-boiler
      - type: rectangle
        fill: black
        outline: white
        width: 1
        x_start: 55
        x_end: 126
        y_start: 228
        y_end: 238
      - type: rectangle
        fill: red
        outline: red
        width: 1
        x_start: 56
        x_end: '{{56+(71/100)*states(''sensor.mixergy_current_charge'')|round}}'
        y_start: 229
        y_end: 237
      - type: text
        x: 125
        y: 230
        anchor: rt
        size: 9
        color: white
        value: '{{states(''sensor.mixergy_current_charge'') | round}}%'
      - type: icon
        x: 55
        y: 240
        size: 15
        color: red
        value: thermometer
      - type: text
        x: 72
        y: 255
        anchor: lb
        size: 15
        color: red
        value: '{{states(''sensor.mixergy_hot_water_temperature'')}}C'
      - type: icon
        x: 55
        y: 257
        size: 15
        color: '{{''red'' if states(''sensor.mixergy_electric_pv_power'') | float
          > 0 else ''black''}}'
        value: solar-power
      - type: text
        x: 64
        y: 297
        anchor: mb
        size: 10
        color: black
        value: 'Updated: {{now().strftime(''%H:%M'')}}'
    target:
      entity_id: open_epaper_link.0000021fb7d03b14
  mode: restart
- id: '1701101378698'
  alias: 'OEPL: Custom Weather'
  description: ''
  trigger:
  - platform: time_pattern
    minutes: '0'
    seconds: '30'
  condition:
  - condition: time
    after: 07:00:00
    before: '22:00:00'
  action:
  - service: open_epaper_link.drawcustom
    data:
      dry-run: false
      background: white
      rotate: '{{180 if now().day < 15 else 0}}'
      payload:
      - type: icon
        x: 7
        y: 12
        size: 20
        value: weather-sunset-up
        color: black
      - type: text
        x: 15
        y: 3
        size: 10
        anchor: mt
        color: black
        value: '{{state_attr(''sun.sun'',''next_rising'') | as_timestamp() | timestamp_custom(''%H:%M'')}}'
      - type: icon
        x: 75
        y: 12
        size: 20
        value: weather-sunset-down
        color: black
      - type: text
        x: 86
        y: 3
        size: 10
        anchor: mt
        color: black
        value: '{{state_attr(''sun.sun'',''next_setting'') | as_timestamp() | timestamp_custom(''%H:%M'')}}'
      - type: rectangle
        x_start: 105
        y_start: 0
        x_end: 294
        y_end: 12
        fill: black
        outline: black
        width: 1
      - type: text
        value: '{{ as_timestamp(state_attr(''sensor.weather_forecast_home'',''forecast_hourly'')[0].datetime)
          | timestamp_custom(''%I'') | int }} {{ as_timestamp(state_attr(''sensor.weather_forecast_home'',''forecast_hourly'')[0].datetime)
          | timestamp_custom(''%p'') | upper }}'
        font: ../../media/GothamRnd-Bold.ttf
        x: 125
        y: 2
        size: 12
        color: white
        anchor: mt
      - type: text
        value: '{{ state_attr(''sensor.weather_forecast_home'',''forecast_hourly'')[0].temperature
          | string }}°C'
        font: ../../media/GothamRnd-Bold.ttf
        x: 125
        y: 50
        size: 14
        color: '{{''black'' if state_attr(''sensor.weather_forecast_home'',''forecast_hourly'')[0].temperature
          | float > severe_temp_low else ''red'' }}'
        anchor: mt
      - type: icon
        value: weather-{{ weather[state_attr('sensor.weather_forecast_home','forecast_hourly')[0].condition]
          }}
        x: 108
        y: 13
        size: 34
        color: '{{''red'' if state_attr(''sensor.weather_forecast_home'',''forecast_hourly'')[0].condition
          in severe_weather else ''black'' }}'
      - type: text
        value: '{{ as_timestamp(state_attr(''sensor.weather_forecast_home'',''forecast_hourly'')[1].datetime)
          | timestamp_custom(''%I'') | int }} {{ as_timestamp(state_attr(''sensor.weather_forecast_home'',''forecast_hourly'')[1].datetime)
          | timestamp_custom(''%p'') | upper }}'
        font: ../../media/GothamRnd-Bold.ttf
        x: 174
        y: 2
        size: 12
        color: white
        anchor: mt
      - type: text
        value: '{{ state_attr(''sensor.weather_forecast_home'',''forecast_hourly'')[1].temperature
          }}°C'
        font: ../../media/GothamRnd-Bold.ttf
        x: 174
        y: 50
        size: 14
        color: '{{''black'' if state_attr(''sensor.weather_forecast_home'',''forecast_hourly'')[1].temperature
          | float > severe_temp_low else ''red'' }}'
        anchor: mt
      - type: icon
        value: weather-{{ weather[state_attr('sensor.weather_forecast_home','forecast_hourly')[1].condition]
          }}
        x: 157
        y: 13
        size: 34
        color: '{{''red'' if state_attr(''sensor.weather_forecast_home'',''forecast_hourly'')[1].condition
          in severe_weather else ''black'' }}    '
      - type: text
        value: '{{ as_timestamp(state_attr(''sensor.weather_forecast_home'',''forecast_hourly'')[2].datetime)
          | timestamp_custom(''%I'') | int }} {{ as_timestamp(state_attr(''sensor.weather_forecast_home'',''forecast_hourly'')[2].datetime)
          | timestamp_custom(''%p'') | upper }}'
        font: ../../media/GothamRnd-Bold.ttf
        x: 223
        y: 2
        size: 12
        color: white
        anchor: mt
      - type: text
        value: '{{ state_attr(''sensor.weather_forecast_home'',''forecast_hourly'')[2].temperature  }}°C'
        font: ../../media/GothamRnd-Bold.ttf
        x: 223
        y: 50
        size: 14
        color: '{{''black'' if state_attr(''sensor.weather_forecast_home'',''forecast_hourly'')[2].temperature
          | float > severe_temp_low else ''red'' }}'
        anchor: mt
      - type: icon
        value: weather-{{ weather[state_attr('sensor.weather_forecast_home','forecast_hourly')[2].condition]
          }}
        x: 206
        y: 13
        size: 34
        color: '{{''red'' if state_attr(''sensor.weather_forecast_home'',''forecast_hourly'')[2].condition
          in severe_weather else ''black'' }}'
      - type: text
        value: '{{ as_timestamp(state_attr(''sensor.weather_forecast_home'',''forecast_hourly'')[3].datetime)
          | timestamp_custom(''%I'') | int }} {{ as_timestamp(state_attr(''sensor.weather_forecast_home'',''forecast_hourly'')[3].datetime)
          | timestamp_custom(''%p'') | upper }}'
        font: ../../media/GothamRnd-Bold.ttf
        x: 272
        y: 2
        size: 12
        color: white
        anchor: mt
      - type: text
        value: '{{ state_attr(''sensor.weather_forecast_home'',''forecast_hourly'')[3].temperature
          }}°C'
        font: ../../media/GothamRnd-Bold.ttf
        x: 272
        y: 50
        size: 14
        color: '{{''black'' if state_attr(''sensor.weather_forecast_home'',''forecast_hourly'')[3].temperature
          | float > severe_temp_low else ''red'' }}'
        anchor: mt
      - type: icon
        value: weather-{{ weather[state_attr('sensor.weather_forecast_home','forecast_hourly')[3].condition]  }}
        x: 255
        y: 13
        size: 34
        color: '{{''red'' if state_attr(''sensor.weather_forecast_home'',''forecast_hourly'')[3].condition
          in severe_weather else ''black'' }}        '
      - type: text
        value: '{{ state_attr(''sensor.weather_forecast_home'',''forecast_daily'')[1].temperature
          }}'
        font: ../../media/GothamRnd-Bold.ttf
        x: 122
        y: 111
        size: 12
        color: '{{''black'' if state_attr(''sensor.weather_forecast_home'',''forecast_daily'')[1].temperature
          | float > severe_temp_low else ''red'' }}'
        anchor: rt
      - type: text
        value: /
        font: ../../media/GothamRnd-Bold.ttf
        x: 125
        y: 112
        size: 14
        color: black
        anchor: mt
      - type: text
        value: '{{ state_attr(''sensor.weather_forecast_home'',''forecast_daily'')[1].templow
          }}'
        font: ../../media/GothamRnd-Bold.ttf
        x: 126
        y: 118
        size: 12
        color: '{{''black'' if state_attr(''sensor.weather_forecast_home'',''forecast_daily'')[1].templow
          | float > severe_temp_low else ''red'' }}'
        anchor: lt
      - type: icon
        value: weather-{{ weather[state_attr('sensor.weather_forecast_home','forecast_daily')[1].condition]}}
        x: 108
        y: 78
        size: 34
        color: '{{''red'' if state_attr(''sensor.weather_forecast_home'',''forecast_daily'')[1].condition
          in severe_weather else ''black'' }}'
      - type: text
        value: '{{ state_attr(''sensor.weather_forecast_home'',''forecast_daily'')[2].temperature
          }}'
        font: ../../media/GothamRnd-Bold.ttf
        x: 171
        y: 111
        size: 12
        color: '{{''black'' if state_attr(''sensor.weather_forecast_home'',''forecast_daily'')[2].temperature
          | float > severe_temp_low else ''red'' }}'
        anchor: rt
      - type: text
        value: /
        font: ../../media/GothamRnd-Bold.ttf
        x: 174
        y: 112
        size: 14
        color: black
        anchor: mt
      - type: text
        value: '{{ state_attr(''sensor.weather_forecast_home'',''forecast_daily'')[2].templow
          }}'
        font: ../../media/GothamRnd-Bold.ttf
        x: 175
        y: 118
        size: 12
        color: '{{''black'' if state_attr(''sensor.weather_forecast_home'',''forecast_daily'')[2].templow
          | float > severe_temp_low else ''red'' }}'
        anchor: lt
      - type: icon
        value: weather-{{ weather[state_attr('sensor.weather_forecast_home','forecast_daily')[2].condition]
          }}
        x: 157
        y: 78
        size: 34
        color: '{{''red'' if state_attr(''sensor.weather_forecast_home'',''forecast_daily'')[2].condition
          in severe_weather else ''black'' }}'
      - type: text
        value: '{{ state_attr(''sensor.weather_forecast_home'',''forecast_daily'')[3].temperature  }}'
        font: ../../media/GothamRnd-Bold.ttf
        x: 220
        y: 111
        size: 12
        color: '{{''black'' if state_attr(''sensor.weather_forecast_home'',''forecast_daily'')[3].temperature
          | float > severe_temp_low else ''red'' }}'
        anchor: rt
      - type: text
        value: /
        font: ../../media/GothamRnd-Bold.ttf
        x: 223
        y: 112
        size: 14
        color: black
        anchor: mt
      - type: text
        value: '{{ state_attr(''sensor.weather_forecast_home'',''forecast_daily'')[3].templow  }}'
        font: ../../media/GothamRnd-Bold.ttf
        x: 224
        y: 118
        size: 12
        color: '{{''black'' if state_attr(''sensor.weather_forecast_home'',''forecast_daily'')[3].templow
          | float > severe_temp_low else ''red'' }}'
        anchor: lt
      - type: icon
        value: weather-{{ weather[state_attr('sensor.weather_forecast_home','forecast_daily')[3].condition]}}
        x: 204
        y: 78
        size: 34
        color: '{{''red'' if state_attr(''sensor.weather_forecast_home'',''forecast_daily'')[3].condition
          in severe_weather else ''black'' }}'
      - type: text
        value: '{{ state_attr(''sensor.weather_forecast_home'',''forecast_daily'')[4].temperature
          }}'
        font: ../../media/GothamRnd-Bold.ttf
        x: 267
        y: 111
        size: 12
        color: '{{''black'' if state_attr(''sensor.weather_forecast_home'',''forecast_daily'')[4].temperature
          | float > severe_temp_low else ''red'' }}'
        anchor: rt
      - type: text
        value: /
        font: ../../media/GothamRnd-Bold.ttf
        x: 272
        y: 112
        size: 14
        color: black
        anchor: mt
      - type: text
        value: '{{ state_attr(''sensor.weather_forecast_home'',''forecast_daily'')[4].templow
          }}'
        font: ../../media/GothamRnd-Bold.ttf
        x: 273
        y: 118
        size: 12
        color: '{{''black'' if state_attr(''sensor.weather_forecast_home'',''forecast_daily'')[4].templow
          | float > severe_temp_low else ''red'' }}'
        anchor: lt
      - type: icon
        value: weather-{{ weather[state_attr('sensor.weather_forecast_home','forecast_daily')[4].condition]
          }}
        x: 255
        y: 78
        size: 34
        color: '{{''red'' if state_attr(''sensor.weather_forecast_home'',''forecast_daily'')[4].condition
          in severe_weather else ''black'' }}'
      - type: rectangle
        x_start: 105
        y_start: 65
        x_end: 294
        y_end: 77
        fill: black
        outline: black
        width: 1
      - type: text
        value: '{{ as_timestamp(state_attr(''sensor.weather_forecast_home'',''forecast_daily'')[1].datetime)
          | timestamp_custom(''%a'') | upper }}'
        font: ../../media/GothamRnd-Bold.ttf
        x: 125
        y: 67
        size: 12
        color: white
        anchor: mt
      - type: text
        value: '{{ as_timestamp(state_attr(''sensor.weather_forecast_home'',''forecast_daily'')[2].datetime)
          | timestamp_custom(''%a'') | upper }}'
        font: ../../media/GothamRnd-Bold.ttf
        x: 174
        y: 67
        size: 12
        color: white
        anchor: mt
      - type: text
        value: '{{ as_timestamp(state_attr(''sensor.weather_forecast_home'',''forecast_daily'')[3].datetime)
          | timestamp_custom(''%a'') | upper }}'
        font: ../../media/GothamRnd-Bold.ttf
        x: 223
        y: 67
        size: 12
        color: white
        anchor: mt
      - type: text
        value: '{{ as_timestamp(state_attr(''sensor.weather_forecast_home'',''forecast_daily'')[4].datetime)
          | timestamp_custom(''%a'') | upper }}'
        font: ../../media/GothamRnd-Bold.ttf
        x: 272
        y: 67
        size: 12
        color: white
        anchor: mt
      - type: text
        value: '{{ state_attr(''sensor.weather_forecast_home'',''forecast_hourly'')[0].temperature
          | float | round | int(0)}}°C'
        font: ../../media/GothamRnd-Bold.ttf
        x: 56
        y: 126
        size: 38
        anchor: mb
        color: '{{''black'' if state_attr(''sensor.weather_forecast_home'',''forecast_hourly'')[0].temperature
          | float | round  > severe_temp_low else ''red'' }}'
      - type: icon
        value: weather-{{ weather[state_attr('sensor.weather_forecast_home','forecast_hourly')[0].condition]
          }}
        x: 6
        y: 6
        size: 92
        color: '{{''red'' if state_attr(''sensor.weather_forecast_home'',''forecast_hourly'')[0].condition
          in severe_weather else ''black'' }}'
    target:
      entity_id:
      - open_epaper_link.0000021f40f13b1f
  variables:
    weather:
      partlycloudy: partly-cloudy
      clear-night: night
      rainy: rainy
      sunny: sunny
      cloudy: cloudy
      fog: fog
      hail: hail
      lightning: lightning
      lightning-rainy: lightning-rainy
      pouring: pouring
      snowy: snowy
      snowy-rainy: snowy-rainy
      windy: windy
      windy-variant: windy-variant
      exceptional: exceptional
    severe_weather:
    - fog
    - hail
    - lightning
    - lightning-rainy
    - pouring
    - snowy
    - snowy-rainy
    - windy
    - windy-variant
    - exceptional
    severe_temp_low: 3
  mode: restart
- id: '1701697431464'
  alias: Presence - home office
  description: ''
  trigger:
  - platform: state
    entity_id:
    - sensor.toms_phone_ble
    to: office
    id: office_entered
  - platform: state
    entity_id:
    - sensor.toms_phone_ble
    from: office
    id: office_left
    for:
      hours: 0
      minutes: 5
      seconds: 0
  condition: []
  action:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - office_left
      sequence:
      - type: turn_off
        device_id: a4b059569334cd311559fcb877f3deba
        entity_id: 06eeebc1e5fcf9143cc03a5b54f13885
        domain: light
        enabled: false
      - type: turn_off
        device_id: 63e528584034c3704aa0ea7b8d0c6adb
        entity_id: f24328478d5751eff84f7aafecbbebc8
        domain: switch
        enabled: false
    - conditions:
      - condition: trigger
        id:
        - office_entered
      sequence:
      - type: turn_on
        device_id: 63e528584034c3704aa0ea7b8d0c6adb
        entity_id: f24328478d5751eff84f7aafecbbebc8
        domain: switch
      - type: turn_on
        device_id: a4b059569334cd311559fcb877f3deba
        entity_id: 06eeebc1e5fcf9143cc03a5b54f13885
        domain: light
  mode: single
- id: '1701724272223'
  alias: Morning - Set main bedroom radiator
  description: ''
  trigger:
  - platform: time
    at: 07:00:00
  condition: []
  action:
  - service: climate.set_temperature
    data:
      temperature: 18
    target:
      entity_id: climate.main_bedroom_radiator_thermostat
  mode: single
- id: '1701795669665'
  alias: 'OEPL: Electricity tariff'
  description: ''
  trigger:
  - platform: state
    entity_id:
    - sensor.octopus_energy_electricity_22l3131941_2380000814991_current_rate
    attribute: start
  condition: []
  action:
  - service: open_epaper_link.drawcustom
    target:
      entity_id: open_epaper_link.0000021d19153414
    data:
      background: white
      rotation: 0
      dry-run: false
      payload:
      - type: text
        x: 76
        y: 3
        size: 25
        anchor: mt
        color: black
        value: '{{(states(''sensor.octopus_energy_electricity_22l3131941_2380000814991_current_rate'')|
          float * 100) | round(1) }}p/kWh'
      - type: icon
        x: 26
        y: 30
        size: 100
        color: '{{''red'' if states(''sensor.octopus_energy_electricity_22l3131941_2380000814991_current_rate'')
          | float > 0.3 else ''black''}}'
        value: transmission-tower
      - type: icon
        x: 90
        y: '{{30 if states(''sensor.octopus_energy_electricity_22l3131941_2380000814991_current_rate'')
          | float >= state_attr(''sensor.octopus_energy_electricity_22l3131941_2380000814991_current_rate'',''current_day_max_rate'')
          | float else 90 if states(''sensor.octopus_energy_electricity_22l3131941_2380000814991_current_rate'')
          | float <= state_attr(''sensor.octopus_energy_electricity_22l3131941_2380000814991_current_rate'',''current_day_min_rate'')
          | float else 70}}'
        size: 40
        color: '{{''red'' if states(''sensor.octopus_energy_electricity_22l3131941_2380000814991_current_rate'')
          | float >= state_attr(''sensor.octopus_energy_electricity_22l3131941_2380000814991_current_rate'',''current_day_max_rate'')
          or states(''sensor.octopus_energy_electricity_22l3131941_2380000814991_current_rate'')
          | float <= state_attr(''sensor.octopus_energy_electricity_22l3131941_2380000814991_current_rate'',''current_day_min_rate'')
          else ''black''}}'
        value: '{{''arrow-up-bold-circle'' if states(''sensor.octopus_energy_electricity_22l3131941_2380000814991_current_rate'')
          | float >= state_attr(''sensor.octopus_energy_electricity_22l3131941_2380000814991_current_rate'',''current_day_max_rate'')
          | float else ''arrow-down-bold-circle'' if states(''sensor.octopus_energy_electricity_22l3131941_2380000814991_current_rate'')
          | float <= state_attr(''sensor.octopus_energy_electricity_22l3131941_2380000814991_current_rate'',''current_day_min_rate'')
          | float else ''speedometer-medium''}}'
      - type: text
        x: 76
        y: 149
        size: 20
        anchor: mb
        color: black
        value: '{{state_attr(''sensor.octopus_energy_electricity_22l3131941_2380000814991_current_rate'',''start'')
          |as_timestamp()| timestamp_custom(''%H:%M'')}}-{{state_attr(''sensor.octopus_energy_electricity_22l3131941_2380000814991_current_rate'',''end'')
          |as_timestamp()| timestamp_custom(''%H:%M'')}}'
  mode: restart
- id: '1702637553110'
  alias: 'OEPL: Coffee settings'
  description: ''
  trigger:
  - platform: state
    entity_id:
    - input_number.coffee_grind_setting_caf
    - input_number.coffee_grind_setting_decaf
  - platform: template
    value_template: '{{(now().day == 1 or now().day == 15) and now().hour == 7}}'
    for:
      hours: 0
      minutes: 0
      seconds: 30
  condition: []
  action:
  - data:
      dry-run: false
      background: white
      rotate: '{{180 if now().day < 15 else 0}}'
      payload:
      - type: text
        x: 74
        y: 2
        size: 20
        color: black
        value: Caffeine
        anchor: mt
      - type: icon
        x: 12
        y: 13
        color: black
        size: 120
        value: coffee-maker
      - type: text
        x: 77
        y: 92
        size: 48
        color: red
        value: '{{states(''input_number.coffee_grind_setting_caf'') | int}}'
        anchor: mm
      - type: line
        x_start: 146
        x_end: 146
        y_start: 20
        y_end: 108
        fill: red
        width: 1
      - type: text
        x: 222
        y: 2
        size: 20
        color: black
        value: Decaf
        anchor: mt
      - type: icon
        x: 158
        y: 13
        color: black
        size: 120
        value: coffee-maker-outline
      - type: text
        x: 223
        y: 92
        size: 48
        color: red
        value: '{{states(''input_number.coffee_grind_setting_decaf'') | int}}'
        anchor: mm
    target:
      entity_id: open_epaper_link.0000021e69133b19
    action: open_epaper_link.drawcustom
  mode: restart
- id: '1704814686625'
  alias: 'OEPL: Literary clock'
  description: ''
  trigger: []
  condition: []
  action:
  - service: open_epaper_link.drawcustom
    target:
      entity_id: open_epaper_link.00000218cf5d3b19
    data:
      background: white
      dry-run: false
      rotate:
        '[object Object]':
      payload:
      - type: rectangle
        x_start: 0
        y_start: 0
        x_end: 296
        y_end: 14
        fill: red
        outline: red
        width: 1
      - type: text
        x: 5
        y: 15
        size: '{% set quote_length = state_attr(''sensor.quote_clock'',''quote_first'')
          | length %}  {% set quote_length = quote_length + state_attr(''sensor.quote_clock'',''quote_time_case'')
          | length + 2 %}  {% set quote_length = quote_length + state_attr(''sensor.quote_clock'',''quote_last'')
          | length %}  {{10 if quote_length > 300 else 12 if quote_length > 150 else
          14 }}'
        value: '{{state_attr(''sensor.quote_clock'',''quote_first'') | striptags}}
          [{{state_attr(''sensor.quote_clock'',''quote_time_case'') | upper}}] {{state_attr(''sensor.quote_clock'',''quote_last'')
          | striptags}}'
        font: ../../media/CourierPrime-Regular.ttf
        max_width: 280
      - type: text
        color: white
        size: 14
        x: 0
        y: 0
        align: right
        value: '{{(state_attr(''sensor.quote_clock'',''author'') +'': '' + state_attr(''sensor.quote_clock'',''title'')
          )| truncate(35, True)}}

          '
  mode: single
- id: '1706642170148'
  alias: 'NFC: Reuben''s tablets'
  description: ''
  trigger:
  - platform: tag
    tag_id: 04-70-7F-62-EC-6B-81
  - platform: tag
    tag_id: D0-50-B3-32
  condition: []
  action:
  - service: counter.decrement
    target:
      entity_id: counter.reuben_tablet
    data: {}
  - service: media_player.volume_set
    data:
      volume_level: 0.5
      entity_id: '{{ media_players[trigger.event.data.device_id] }}'
  - service: tts.google_translate_say
    data:
      entity_id: '{{ media_players[trigger.event.data.device_id] }}'
      message: You have {{states('counter.reuben_tablet') }} tablets left.
  variables:
    media_players:
      43ddd1e400d41d9d547f7bc24a95f86d: media_player.reuben_s_room_speaker
      4dd136882e204aec5b9809887714f25b: media_player.seb_s_home
  mode: single
- id: '1707757875572'
  alias: 'Notify: Reuben''s tablets'
  description: Send a notification when tablets remaining <= 10
  trigger:
  - platform: state
    entity_id:
    - counter.reuben_tablet
  condition:
  - condition: numeric_state
    entity_id: counter.reuben_tablet
    below: 11
  action:
  - service: notify.tom_and_anna
    data:
      title: "\U0001F48A Reuben's tablets"
      message: Reuben only has {{ states('counter.reuben_tablet') }} tablet{{'s' if
        states('counter.reuben_tablet')|int > 1 else ''}} remaining
  mode: single
- id: '1708165342713'
  alias: 'Dishwasher: Finished notification'
  description: ''
  trigger:
  - entity_id:
    - binary_sensor.dishwasher
    from: 'on'
    platform: state
    to: 'off'
  condition: []
  action:
  - data:
      entity_id:
      - media_player.kitchen_display
      - media_player.living_room_display
      - media_player.office_wifi
      message: The dishwasher has finished.
    service: tts.google_translate_say
  - service: notify.tom_and_anna
    data:
      title: Dishwasher
      message: "\U0001F37D️ The dishwasher has finished"
  mode: single
- id: '1709651798349'
  alias: 'Notify: Oven hot'
  description: ''
  trigger:
  - platform: numeric_state
    entity_id:
    - sensor.solax_local_load_power
    below: 2000
  condition:
  - condition: template
    value_template: '{{state_attr(''automation.notify_oven_hot'',''last_triggered'').strftime("%Y%m%d")
      != now().strftime("%Y%m%d") }}'
  action:
  - service: notify.mobile_app_toms_phone
    metadata: {}
    data:
      title: ♨️Oven Temperature
      message: It looks like the oven is hot
  - service: automation.turn_off
    metadata: {}
    data:
      stop_actions: true
    target:
      entity_id: automation.notify_oven_hot
  mode: single
- id: '1712065994854'
  alias: 'Notify: Mixergy PV Diverter Issue'
  description: ''
  trigger:
  - platform: state
    entity_id:
    - sensor.mixergy_clamp_power
    to: '0'
    for:
      hours: 0
      minutes: 5
      seconds: 0
  condition: []
  action:
  - service: notify.tom_and_anna
    metadata: {}
    data:
      message: "\U0001F304Check the Mixregy PV diverter. It hasn't reported any data
        for 5minutes an might need a disconnect/reconnect."
      title: Mixergy PV Issue
  mode: single
- id: '1713194068751'
  alias: 'OEPL: Quotes'
  description: ''
  trigger:
  - platform: state
    entity_id:
    - sensor.quotes
  condition:
  - condition: time
    after: 09:00:00
    before: '19:00:00'
    weekday:
    - mon
    - tue
    - wed
    - thu
    - fri
  action:
  - service: open_epaper_link.drawcustom
    data:
      dry-run: false
      background: white
      rotate: '{{180 if now().day < 15 else 0 }}'
      payload:
      - type: icon
        x: -15
        y: -20
        size: 96
        value: format-quote-open
        color: red
      - type: icon
        x: 215
        y: 55
        size: 96
        value: format-quote-close
        color: red
      - type: text
        x: 25
        y: 40
        size: 14
        max_width: 250
        value: '{{state_attr(''sensor.quotes'',''quote'')}}'
        color: black
        font: ../../media/CourierPrime-Regular.ttf
      - type: text
        x: 296
        y: 3
        size: 12
        anchor: rt
        value: '{{state_attr(''sensor.quotes'',''author'')}}'
        color: black
        font: ../../media/CourierPrime-Regular.ttf
    target:
      entity_id: open_epaper_link.0000021f40f13b1f
  mode: single
- id: '1713342045966'
  alias: 'Solax: Reset battery charge target at 4pm'
  description: Reset grid charge params every afternoon, after possible forced charging
    completed during Cosy rate
  trigger:
  - platform: time
    at: '15:58:00'
  - platform: time
    at: 00:00:00
  condition: []
  action:
  - repeat:
      sequence:
      - data:
          level: 10
        action: rest_command.solax_local_charge_battery_from_grid
      - delay:
          seconds: 10
      - data: {}
        target:
          entity_id: sensor.solax_rest_local_settings
        action: homeassistant.update_entity
      until:
      - condition: template
        value_template: '{{ (states(''sensor.solax_local_battery_charge_from_grid_to'')|int==10)
          or repeat.index == 3 }}      '
  mode: single
- id: '1714474918088'
  alias: Handle clear garage notification msg
  description: ''
  trigger:
  - platform: event
    event_type: mobile_app_notification_action
    event_data:
      action: ACK_GARAGE
  condition: []
  action:
  - service: alert.turn_off
    metadata: {}
    data: {}
    target:
      entity_id: alert.garage_door
  mode: single
- id: '1716365991212'
  alias: Wedding anniversary wake-up music
  description: Play music from YouTube Music on 23/05
  trigger:
  - platform: template
    value_template: '{{now().strftime("%H:%M %d %m") == "06:50 23 05"}}'
  action:
  - service: media_player.volume_set
    data:
      volume_level: 0.5
    target:
      entity_id: media_player.lenovosmartclock9603
  - service: media_player.select_source
    data:
      source: media_player.lenovosmartclock9603
      entity_id: media_player.ytube_music_player
  - service: media_player.play_media
    data:
      media_content_id: 3Z_4Y4DrYAE
      media_content_type: track
    target:
      entity_id: media_player.ytube_music_player
  mode: single
- id: '1716377345280'
  alias: 'AI: Solar forecast summary'
  description: ''
  trigger: []
  condition: []
  action:
  - service: conversation.process
    metadata: {}
    data:
      agent_id: conversation.openai_conversation
      text: For this task, you are solar energy consultant.   Please provide your
        thoughts on today's predicted solar yield as it relates to the time of year
        in Yorkshire United Kingdom and the provided forecast for the upcoming days
        Today's solar yield {{states('sensor.solcast_pv_forecast_forecast_today')}}
        kWh JSON array of forecasted solar yield for the next 6 days, the first entry
        is tomorrow followed by subsequent days [ {{states('sensor.solcast_pv_forecast_forecast_tomorrow')}},
        {{states('sensor.solcast_pv_forecast_forecast_day_3')}}, {{states('sensor.solcast_pv_forecast_forecast_day_4')}},
        {{states('sensor.solcast_pv_forecast_forecast_day_5')}}, {{states('sensor.solcast_pv_forecast_forecast_day_6')}},
        {{states('sensor.solcast_pv_forecast_forecast_day_7')}} ]
    response_variable: reply
  - service: notify.mobile_app_toms_phone
    metadata: {}
    data:
      title: Solar forecast summary
      message: '{{reply.response.speech.plain.speech}}'
  mode: single
- id: '1718027777948'
  alias: Reuben's tablet daily reminder
  description: ''
  trigger:
  - platform: time
    at: '19:45:00'
  condition:
  - condition: template
    value_template: '{{as_datetime(states.counter.reuben_tablet.last_updated).day
      - now().day < 0}}'
  action:
  - service: notify.tom_and_anna
    data:
      message: "\U0001F48A Reuben hasn't had his tablet today"
      title: Reuben's tablets
  mode: single
- id: '1720005497233'
  alias: 'HA: Disk usage'
  description: Send notification when disk usage > 85%
  trigger:
  - platform: numeric_state
    entity_id:
    - sensor.system_monitor_disk_usage
    for:
      hours: 0
      minutes: 0
      seconds: 0
    above: 84.9
  - platform: time
    at: 09:30:00
  condition:
  - condition: numeric_state
    entity_id: sensor.system_monitor_disk_usage
    above: 85
  action:
  - service: notify.mobile_app_toms_phone
    metadata: {}
    data:
      title: Home Assistant
      message: HA disk usage is {{states('sensor.system_monitor_disk_usage')}}
  mode: single
- id: '1721404384264'
  alias: 'OEPL: Flightradar24'
  description: ''
  trigger:
  - platform: event
    event_type: flightradar24_entry
  condition:
  - condition: time
    after: 08:45:00
    before: '18:00:00'
    weekday:
    - mon
    - tue
    - wed
    - thu
    - fri
  action:
  - service: open_epaper_link.drawcustom
    data:
      dry-run: false
      background: white
      rotate: '{{180 if now().day < 15 else 0}}'
      payload:
      - type: rectangle
        color: black
        width: 2
        x_start: 5
        x_end: 291
        y_start: 79
        y_end: 128
        fill: white
        outline: black
      - type: rectangle
        color: black
        width: 1
        x_start: 5
        x_end: 291
        y_start: 77
        y_end: 98
        fill: black
        outline: black
      - type: text
        x: 10
        y: 5
        size: 18
        value: '{{trigger.event.data.airline}}'
      - type: text
        x: 10
        y: 25
        size: 12
        value: '{{trigger.event.data.aircraft_model}}'
      - type: text
        x: 10
        y: 40
        size: 12
        value: '{{trigger.event.data.aircraft_code}}'
      - type: text
        x: 10
        y: 55
        size: 12
        value: '{{trigger.event.data.callsign}}'
      - type: rectangle
        color: black
        width: 2
        x_start: 165
        x_end: 291
        y_start: 3
        y_end: 75
        fill: white
        outline: black
      - type: dlimg
        url: '{{trigger.event.data.aircraft_photo_small}}'
        x: 167
        y: 5
        xsize: 124
        ysize: 70
        rotate: 0
      - type: icon
        x: 73
        y: 81
        size: 20
        value: mdi:airplane-takeoff
        anchor: mt
        color: red
      - type: dlimg
        url: https://flagsapi.com/{{trigger.event.data.airport_origin_country_code}}/flat/16.png
        x: 7
        y: 112
        anchor: lt
        xsize: 16
        ysize: 16
        rotate: 0
      - type: text
        x: 7
        y: 81
        color: white
        size: 18
        value: '{{trigger.event.data.time_real_departure | timestamp_custom(''%H:%M'')}}'
      - type: text
        x: 7
        y: 100
        size: 14
        anchor: lt
        color: black
        value: '{{trigger.event.data.airport_origin_city}}'
      - type: text
        x: 27
        y: 115
        size: 10
        anchor: lt
        color: black
        value: '{{trigger.event.data.airport_origin_country_name}}'
      - type: icon
        x: 229
        y: 81
        size: 20
        value: mdi:airplane-landing
        color: red
        anchor: mt
      - type: dlimg
        url: https://flagsapi.com/{{trigger.event.data.airport_destination_country_code}}/flat/16.png
        x: 150
        y: 112
        anchor: lt
        xsize: 16
        ysize: 16
        rotate: 0
      - type: text
        x: 289
        y: 81
        size: 18
        anchor: rt
        color: white
        value: '{{trigger.event.data.time_estimated_arrival | timestamp_custom(''%H:%M'')}}'
      - type: text
        x: 150
        y: 100
        size: 14
        anchor: lt
        color: black
        value: '{{trigger.event.data.airport_destination_city}}'
      - type: text
        x: 170
        y: 115
        size: 10
        anchor: lt
        color: black
        value: '{{trigger.event.data.airport_destination_country_name}}'
    target:
      entity_id: open_epaper_link.0000021f40f13b1f
  mode: single
- id: '1721733404944'
  alias: 'Mixergy: Reset PV charge limit'
  description: ''
  trigger:
  - platform: time
    at: '21:00:00'
  condition: []
  action:
  - service: number.set_value
    metadata: {}
    data:
      value: '30'
    target:
      entity_id: number.pv_charge_limit
  mode: single
- id: '1729786913584'
  alias: 'Solax: Force charge battery in evening'
  description: At 22:00 force charge battery from grid for 90mins if tariff is low
  triggers:
  - trigger: time
    at: '22:00:00'
  conditions:
  - condition: numeric_state
    entity_id: sensor.solcast_pv_forecast_forecast_tomorrow
    below: 20
  - condition: numeric_state
    entity_id: sensor.solax_local_battery_soc
    below: 70
  actions:
  - action: input_number.set_value
    metadata: {}
    data:
      value: 90
    target:
      entity_id: input_number.solax_force_charge_duration_mins
  - action: input_number.set_value
    metadata: {}
    data:
      value: 100
    target:
      entity_id: input_number.solax_battery_soc_target
  - action: script.solax_force_charge
    metadata: {}
    data: {}
  mode: restart
- id: '1731598967532'
  alias: Birthday wakeup music
  description: Play Happy Birthday by Altered Image on birthdays
  triggers:
  - value_template: '{{now().strftime("%H:%M %m %d") == "07:05 11 19"}}'
    trigger: template
  - value_template: '{{now().strftime("%H:%M %m %d") == "07:00 09 28"}}'
    trigger: template
  - value_template: '{{now().strftime("%H:%M %m %d") == "07:00 10 26"}}'
    trigger: template
  - value_template: '{{now().strftime("%H:%M %m %d") == "07:00 01 25"}}'
    trigger: template
  conditions: []
  actions:
  - data:
      volume_level: 0.5
    action: media_player.volume_set
    target:
      entity_id: media_player.upstairs
  - data:
      source: media_player.upstairs
    action: media_player.select_source
    target:
      entity_id: media_player.ytube_music_player
  - data:
      media_content_id: 4skFDCjxHkU
      media_content_type: track
    target:
      entity_id: media_player.ytube_music_player
    action: media_player.play_media
  mode: single
- id: '1733399277741'
  alias: 'OEPL: Xmas Advent Countdown'
  description: Count down the days till Christmas Day! The date of Christmas is set
    in the variable days_until_xmas and shouldn't need altering year on year. All
    images are pulled down from an external server (https://www.chunkymedia.co.uk)
    - keep you surprised! All images are royalty free from Pixabay. The text used
    is 'Days 'til Christmas', 'Day 'til Christmas', and 'Merry Christmas' - adjust
    according to your local language. Edit in YAML.
  triggers:
  - at: 07:02:00
    trigger: time
  actions:
  - data:
      background: white
      rotate: 270
      payload:
      - type: text
        value: '{{ '''' if days_until_xmas <=0 else days_until_xmas }}'
        font: ../../media/GothamRnd-Bold.ttf
        x: 64
        y: '{{ 168 if days_until_xmas > 99 else 160 | int }}'
        size: '{{ 60 if days_until_xmas > 99 else 84 | int }}'
        color: red
        anchor: mt
        y_padding: 0
        spacing: 2
      - type: dlimg
        url: "{% if days_until_xmas <= 25 %}\n  https://www.chunkymedia.co.uk/epaper-xmas/dither_it_epaper-xmas-{{
          days_until_xmas | string }}.jpg\n{% else %} \n  https://www.chunkymedia.co.uk/epaper-xmas/dither_it_epaper-xmas-grinch.jpg\n{%
          endif %}"
        x: 0
        y: 0
        xsize: 128
        ysize: '{{ 220 if days_until_xmas <=0 else 156 }}'
        rotate: 0
      - type: text
        value: "{% if days_until_xmas > 0 %}\n  {{ (\"Days\" if days_until_xmas >
          1 else \"Day\") | string + \" 'til\"}} \n{% else %} \n  Merry\n{% endif
          %}"
        font: ../../media/GothamRnd-Bold.ttf
        x: 64
        y: 230
        size: 24
        color: black
        anchor: mt
      - type: text
        value: Christmas
        font: ../../media/GothamRnd-Bold.ttf
        x: 64
        size: 24
        color: black
        anchor: mt
    target:
      entity_id:
      - open_epaper_link.0000021f40f13b1f
    action: open_epaper_link.drawcustom
  mode: restart
  variables:
    days_until_xmas: "{% set days_until = (today_at().replace(day=25, month=12) |
      as_local - today_at()).days | int %}  {% if days_until < 0 %}\n  {{(today_at().replace(day=25,
      month=12, year=now().year+1) | as_local - today_at()).days | int }} \n{% else
      %} \n  {{days_until | int}} \n{% endif %} "
- id: '1733949040739'
  alias: 'Zappi: Software update'
  description: ''
  triggers:
  - type: turned_on
    device_id: ce8332af9196e047a1fc405316b7a711
    entity_id: de9acab60b7071cc4b73469314944a50
    domain: binary_sensor
    trigger: device
  conditions: []
  actions:
  - action: notify.mobile_app_toms_phone
    data:
      message: An software update is available for Zappi
      title: Zappi
  mode: single
- id: '1733949463107'
  alias: 'Zappi: charging started'
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - sensor.myenergi_zappi_plug_status
    to: Charging
  conditions: []
  actions:
  - action: notify.tom_and_anna
    data:
      message: Zappi has started charging the car
      title: ⚡Zappi
  mode: single
- id: '1733949518949'
  alias: 'Zappi: Charging complete'
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - sensor.myenergi_zappi_plug_status
    to:
    from: Charging
  conditions: []
  actions:
  - action: notify.tom_and_anna
    data:
      message: Zappi has finished charging the car. {{states('sensor.myenergi_zappi_charge_added_session')}}kWH
        ({{(100*((states('sensor.myenergi_zappi_charge_added_session')|float/72)))
        | round(2)}}%) added in this charge session.
      title: ⚡Zappi
  mode: single
- id: '1734361788849'
  alias: Sociable Hours
  description: Turn on Do Not Disturb in the evenings and off in the mornings.
  triggers:
  - trigger: time
    at: '23:00:00'
    id: evening
  - trigger: time
    at: 07:00:00
    id: weekday-morning
  - trigger: time
    at: 08:00:00
    id: weekend-morning
  conditions:
  - condition: or
    conditions:
    - condition: trigger
      id:
      - evening
      - weekend-morning
    - condition: and
      conditions:
      - condition: time
        after: 07:00:00
        weekday:
        - mon
        - tue
        - wed
        - thu
        - fri
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - evening
      sequence:
      - action: input_boolean.turn_on
        metadata: {}
        data: {}
        target:
          entity_id: input_boolean.do_not_disturb
    - conditions:
      - condition: trigger
        id:
        - weekday-morning
        - weekend-morning
      sequence:
      - action: input_boolean.turn_off
        metadata: {}
        data: {}
        target:
          entity_id: input_boolean.do_not_disturb
  mode: single
